var H=Object.defineProperty,G=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var k=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var A=(o,t,n)=>t in o?H(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n,p=(o,t)=>{for(var n in t||(t={}))J.call(t,n)&&A(o,n,t[n]);if(k)for(var n of k(t))K.call(t,n)&&A(o,n,t[n]);return o},h=(o,t)=>G(o,Y(t));import{s as X,r as m,aA as f,a as e,j as l,B as Z,ax as I,aS as ee,n as te,F as x}from"./index.js";import{c as re,i as oe,r as ne}from"./jsx-runtime_commonjs-proxy.js";import{B as ae}from"./Badge.js";import{D as M,B as se,a as ie}from"./DatePicker.js";import{d as le,s as ce}from"./Navbar.js";import{d as me}from"./Add.js";import{d as R}from"./string.helper.js";import{T as g}from"./Typography.js";import{S as T}from"./Stack.js";import{D as w}from"./Divider.js";import{T as _}from"./TextInput.js";import{T as de}from"./TextEditor.js";import{c as D,b as S,d as ue,h as pe,g as he,o as ge,u as L,a as fe,C as xe,F as ve}from"./array.js";import{S as ye}from"./SelectHookForm.js";import{d as W,a as j}from"./CheckBoxOutlineBlank.js";import{A as U}from"./AutocompleteServer.js";import{C as Q}from"./Checkbox.js";import{A as _e}from"./Alert.js";import{L as be,c as Ce}from"./LoadingButton.js";import{u as Fe,S as Ne,d as Se}from"./FilterList.js";import{d as Ie}from"./Search.js";import{P as Te}from"./TextField.js";import{B as O}from"./Button.js";import{B as Me}from"./BootstrapTooltip.js";import{B as we}from"./Box.js";import{I as E}from"./InputAdornment.js";import{I as Oe}from"./IconButton.js";import{P as Be}from"./Pagination.js";import{C as Pe}from"./ErrorIcon.js";import{L as ke}from"./LinearProgress.js";import"./createSvgIcon.js";import"./useControlled.js";import"./useIsFocusVisible.js";import"./isHostComponent.js";import"./Tooltip.js";import"./Popper.js";import"./Portal.js";import"./Grow.js";import"./Close2.js";import"./MobileDatePicker.js";import"./MonthPicker.js";import"./usePickerState.js";import"./Grid.js";import"./ButtonBase.js";import"./Backdrop.js";import"./index7.js";import"./Paper.js";import"./Modal2.js";import"./ContentProvider.js";import"./useModal.js";import"./App.module.js";import"./regex.js";import"./FormHelperText.js";import"./upperFirst.js";import"./MenuItem.js";import"./List.js";import"./listItemIconClasses.js";import"./listItemTextClasses.js";import"./useFetch.js";import"./useHttpService.js";import"./Autocomplete.js";import"./Close.js";import"./Chip.js";import"./react-is.production.min.js";import"./GlobalStyles.js";import"./StyledGridOverlay.js";var B={},Ae=oe.exports;Object.defineProperty(B,"__esModule",{value:!0});var P=B.default=void 0,De=Ae(re),Ee=ne,$e=(0,De.default)((0,Ee.jsx)("path",{d:"m2.53 19.65 1.34.56v-9.03l-2.43 5.86c-.41 1.02.08 2.19 1.09 2.61zm19.5-3.7L17.07 3.98c-.31-.75-1.04-1.21-1.81-1.23-.26 0-.53.04-.79.15L7.1 5.95c-.75.31-1.21 1.03-1.23 1.8-.01.27.04.54.15.8l4.96 11.97c.31.76 1.05 1.22 1.83 1.23.26 0 .52-.05.77-.15l7.36-3.05c1.02-.42 1.51-1.59 1.09-2.6zM7.88 8.75c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm-2 11c0 1.1.9 2 2 2h1.45l-3.45-8.34v6.34z"}),"Style");P=B.default=$e;const qe=X(ae)(({theme:o})=>({"& .MuiBadge-badge":{right:-1,top:7,border:`1.5px solid ${o.palette.background.paper}`,padding:"0 4px"}})),ze="_main_1yowg_1",Re="_sidebar_1yowg_9",Le="_pagination_1yowg_22",We="_searchInput_1yowg_35",je="_element_1yowg_42",Ue="_active_1yowg_63",Qe="_title_1yowg_67",Ve="_fechas_1yowg_71",He="_fecha_1yowg_71",Ge="_subtitle_1yowg_91",Ye="_content_1yowg_109",Je="_appbar_1yowg_117",Ke="_backButton_1yowg_130",Xe="_titulo_1yowg_137",Ze="_parrafo_1yowg_158";var d={main:ze,sidebar:Re,pagination:Le,searchInput:We,element:je,active:Ue,title:Qe,fechas:Ve,fecha:He,subtitle:Ge,content:Ye,appbar:Je,backButton:Ke,titulo:Xe,parrafo:Ze};const V=()=>{const o=m.exports.useContext(f),{nota:t,setNota:n,showForm:r,setShowForm:a}=o;return e("div",{className:d.appbar,children:l("div",{className:d.backButton,onClick:()=>{a(t?!1:!r),n(null)},children:[e(Z,{component:!r&&!t?me:le}),e("span",{children:t||r?"Atr\xE1s":"Agregar"})]})})},$=()=>{const{isPhoneScreen:o,nota:t}=m.exports.useContext(f);return l(g,{className:d.content,component:"div",children:[!o&&e(V,{}),e("span",{className:d.titulo,children:t==null?void 0:t.titulo}),l("span",{className:d.fecha,children:[e("strong",{children:"Creada por"}),": ",t==null?void 0:t.nombre," ",t==null?void 0:t.apellido]}),(t==null?void 0:t.persona_encargada)&&l("span",{className:d.fecha,children:[e("strong",{children:"Persona con qui\xE9n se habl\xF3"}),": ",t==null?void 0:t.persona_encargada]}),l(T,{direction:{xs:"column",md:"row"},justifyContent:"space-between",children:[l("span",{className:d.fecha,children:[e("strong",{children:"Mes"}),": ",I(t==null?void 0:t.mes,"MMMM/yyyy")]}),l("span",{className:d.fecha,children:[e("strong",{children:"Fecha de creaci\xF3n"}),":"," ",I(t==null?void 0:t.fecha,"dd/MM/yyyy hh:mm aaaa")]})]}),e(w,{}),e("div",{className:d.parrafo,children:R(t==null?void 0:t.notas)})]})},et=D().shape({titulo:S().trim().notRequired().nullable(!0),negocio:D().shape({id:ue().typeError("Favor ingresar un n\xFAmero").min(1,"Favor ingresar el negocio").integer("Favor ingresar el negocio").positive("Favor ingresar el negocio").required("Favor ingresar el negocio")}).typeError("Favor ingresar el negocio").required("Favor ingresar el negocio"),tipo:S().trim().required("Favor ingresar el tipo de la nota"),persona_encargada:S().trim().notRequired().nullable(!0),notas:S().trim().required("Favor ingresar la nota"),mes:pe().typeError("Favor ingresar el mes").transform(ee).required("Favor ingresar el mes")}),tt=o=>{const{negocioNota:t,pagination:n}=m.exports.useContext(f),{refresh:r}=n,a=te(),[,i]=a,s=he({mode:"onSubmit",resolver:ge(et),defaultValues:{mes:"",notas:"",persona_encargada:"",titulo:"",tipo:"",negocio:null}}),{reset:u,getValues:c}=s;return m.exports.useEffect(()=>{(()=>{u(p(p({},c()),t))})()},[t]),{onSubmit:v=>{var b;(b=o.current)==null||b.scrollTo(0,0),i("/admin/notas",{method:"POST",data:v}).then(C=>{C.data&&!C.error&&(r(),u(h(p({},v),{titulo:"",notas:"",persona_encargada:""})))})},fetcherSubmit:a,form:s}},rt=()=>{var i;const{formState:o,control:t,setValue:n}=L(),{errors:r}=o,a=fe({control:t,name:"mes"});return l(T,{direction:{xs:"column",md:"row"},spacing:1,children:[e(ye,{label:"Tipo de nota",disableBox:!0,name:"tipo",values:["CONTRATO","DECIMO","F03","ITBMS","LIQUIDACION","SIPE"],options:["CONTRATO","DECIMO","F03","ITBMS","LIQUIDACION","SIPE"],required:!0,error:!!r.tipo,helperText:(i=r.tipo)==null?void 0:i.message,size:"small"}),e(M,{label:"Mes de la nota",views:["month","year"],inputFormat:"MM/yyyy",value:a,onChange:s=>n("mes",s),renderInput:s=>{var u;return e(_,h(p({size:"small",fullWidth:!0},s),{error:!!r.mes,helperText:(u=r.mes)==null?void 0:u.message}))}})]})},ot=()=>{const{control:o}=L();return e(xe,{name:"negocio",control:o,render:({field:t,fieldState:n})=>{const{error:r}=n,{onChange:a}=t;return e(U,h(p({},t),{ref:null,inputProps:{label:"Negocio",margin:"dense",required:!0,error:!!r,helperText:r==null?void 0:r.message},disableStyle:!0,onChange:(i,s)=>a(s),isOptionEqualToValue:(i,s)=>i.id===s.id,urlFetch:"/admin/negocios/autocomplete",size:"small",getOptionLabel:i=>`${i.tipo||""} ${i.nombre_negocio||""}`,renderOption:(i,s,{selected:u})=>m.exports.createElement("li",h(p({},i),{key:s.id,style:{textOverflow:"ellipsis",whiteSpace:"nowrap"}}),e(Q,{icon:e(W,{}),checkedIcon:e(j,{}),checked:u,size:"small"}),l("div",{style:{display:"flex",flexDirection:"column",textTransform:"uppercase"},children:[l(g,{variant:"body1",fontWeight:"bold",children:[s.tipo," ",s.nombre_negocio]}),s.ruc&&s.ruc!==""?e(g,{variant:"body2",children:s.ruc}):e(x,{}),s.ruta&&s.ruta!==""?l(g,{variant:"body2",children:["RUTA: ",s.ruta]}):e(x,{})]}))}))}})},q=()=>{var b,C;const o=m.exports.useRef(null),{onSubmit:t,fetcherSubmit:n,form:r}=tt(o),[a,,i,s]=n,{register:u,handleSubmit:c,formState:N}=r,{errors:v}=N;return e(ve,h(p({},r),{children:l(T,{spacing:1,flexGrow:1,direction:"column",padding:"0 10px 10px 10px",component:"form",sx:{overflowY:"auto"},ref:o,children:[e(g,{variant:"h4",textAlign:"center",children:"Formulario de notas"}),(i||s)&&e(_e,{variant:"outlined",severity:i?"success":"error",children:(i==null?void 0:i.message)||(s==null?void 0:s.message)}),e(ot,{}),e(rt,{}),l(T,{spacing:1,direction:{xs:"column",md:"row"},children:[e(_,h(p({label:"T\xEDtulo",size:"small",fullWidth:!0},u("titulo")),{error:!!v.titulo,helperText:(b=v.titulo)==null?void 0:b.message})),e(_,h(p({label:"Persona con quien se habl\xF3",size:"small",fullWidth:!0},u("persona_encargada")),{error:!!v.persona_encargada,helperText:(C=v.persona_encargada)==null?void 0:C.message}))]}),e(de,{name:"notas",height:300}),e(be,{loading:a,loadingIndicator:"Enviando...",variant:"outlined",onClick:c(t),children:"Guardar"})]})}))},F=m.exports.createContext({}),nt=({children:o})=>{const t=Fe(),{pagination:n}=m.exports.useContext(f),{params:r}=n,[a,i]=m.exports.useState({mes:(r==null?void 0:r.mes)||null,fecha:(r==null?void 0:r.fecha)||null,negocio:(r==null?void 0:r.negocio)||null,tipo:(r==null?void 0:r.tipo)||null});return e(F.Provider,{value:{menu:t,filtros:a,setFiltros:s=>i(s)},children:o})},at="_menu_19nmr_1",st="_item_19nmr_8",it="_action_19nmr_15";var y={menu:at,item:st,action:it};const lt=()=>{const{filtros:o,setFiltros:t}=m.exports.useContext(F);return e(Ne,{label:"Tipo de nota",disableBox:!0,value:(o==null?void 0:o.tipo)||"",onChange:n=>t(h(p({},o),{tipo:n.target.value})),values:["CONTRATO","DECIMO","F03","ITBMS","LIQUIDACION","SIPE"],options:["CONTRATO","DECIMO","F03","ITBMS","LIQUIDACION","SIPE"],size:"small"})},ct=()=>{var n;const{filtros:o,setFiltros:t}=m.exports.useContext(F);return e(U,{ref:null,fullWidth:!0,inputProps:{label:"Negocio",margin:"dense",fullWidth:!0},disableStyle:!0,value:(n=o==null?void 0:o.negocio)!=null?n:null,onChange:(r,a)=>t(h(p({},o),{negocio:a})),isOptionEqualToValue:(r,a)=>r.id===a.id,urlFetch:"/admin/negocios/autocomplete",size:"small",getOptionLabel:r=>`${r.tipo||""} ${r.nombre_negocio||""} - ${r.id}`,renderOption:(r,a,{selected:i})=>l("li",h(p({},r),{style:{textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[e(Q,{icon:e(W,{}),checkedIcon:e(j,{}),checked:i,size:"small"}),l("div",{style:{display:"flex",flexDirection:"column",textTransform:"uppercase"},children:[l(g,{variant:"body1",fontWeight:"bold",children:[a.tipo," ",a.nombre_negocio]}),a.ruc&&a.ruc!==""?e(g,{variant:"body2",children:a.ruc}):e(x,{}),a.ruta&&a.ruta!==""?l(g,{variant:"body2",children:["RUTA: ",a.ruta]}):e(x,{})]})]}))})},mt=()=>{const{menu:o,filtros:t,setFiltros:n}=m.exports.useContext(F),{pagination:r}=m.exports.useContext(f),{setParams:a}=r,{anchorEl:i,handleClose:s,open:u}=o;return e(Te,{open:u,anchorEl:i,onClose:s,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:l("div",{className:y.menu,children:[e("div",{className:y.item,children:e(M,{label:"Mes de la nota",views:["month","year"],inputFormat:"MM/yyyy",value:t.mes,onChange:c=>n(h(p({},t),{mes:c})),renderInput:c=>e(_,p({size:"small",fullWidth:!0},c))})}),e("div",{className:y.item,children:e(M,{label:"Fecha de creaci\xF3n",value:t.fecha,inputFormat:"dd/MM/yyyy",onChange:c=>n(h(p({},t),{fecha:c})),renderInput:c=>e(_,p({size:"small",fullWidth:!0},c))})}),e("div",{className:y.item,children:e(lt,{})}),e("div",{className:y.item,children:e(ct,{})}),l("div",{className:y.action,children:[e(O,{variant:"outlined",color:"inherit",onClick:()=>s(),children:"Cerrar"}),e(O,{variant:"outlined",color:"primary",onClick:()=>{a(t),s()},children:"Filtrar"})]})]})})},dt=()=>{const{menu:o}=m.exports.useContext(F),{pagination:t}=m.exports.useContext(f),{search:n,sendSearch:r}=t,{handleClick:a}=o,[i,s]=m.exports.useState(n),u=c=>{c.preventDefault();const N=Object.fromEntries(new FormData(c.currentTarget));r(N.q)};return l("form",{className:d.searchInput,onSubmit:u,children:[e(_,{variant:"standard",type:"text",name:"q",value:i,placeholder:"Buscar...",fullWidth:!0,size:"small",onChange:c=>s(c.target.value),InputProps:{endAdornment:l(we,{display:"flex",alignItems:"center",children:[e(E,{position:"end",children:e(Ie,{})}),e(E,{position:"end",children:e(Me,{title:"Filtros",placement:"top",children:e(Oe,{size:"small",onClick:a,children:e(Se,{})})})})]})}}),e(mt,{})]})},ut=()=>{const{pagination:o}=m.exports.useContext(f),{fetcher:t,page:n,setPage:r}=o,[,,a]=t;return!a||a&&!a.paginas?e(x,{}):e("div",{className:d.pagination,children:e(Be,{color:"primary",count:a==null?void 0:a.paginas,page:n,onChange:(i,s)=>r(s)})})},z=()=>{var u;const{pagination:o,nota:t,setNota:n}=m.exports.useContext(f),{fetcher:r}=o,[a,,i,s]=r;return l("div",{className:d.sidebar,children:[l("div",{children:[e(nt,{children:e(dt,{})}),a&&e(ke,{}),s&&e(Pe,{label:s.message}),e("ul",{children:(u=i==null?void 0:i.resultados)==null?void 0:u.map(c=>l(g,{component:"li",className:`${d.element} ${(t==null?void 0:t.id)===c.id&&d.active}`,onClick:()=>n(c),children:[e("span",{className:d.title,children:c.titulo}),e("div",{className:d.subtitle,children:R(c.notas)}),l("div",{className:d.fechas,children:[e("span",{className:d.fecha,children:I(c.mes,"MM/yyyy")}),e("span",{className:d.fecha,children:I(c.fecha,"dd/MM/yyyy HH:mm aaaa")})]})]},c.id))})]}),e(ut,{})]})},pt=()=>{const{isPhoneScreen:o,nota:t,showForm:n}=m.exports.useContext(f);return e("section",{className:d.main,children:o?l(x,{children:[e(V,{}),!t&&!n&&e(z,{}),n&&e(q,{}),t&&!n&&e($,{})]}):l(x,{children:[e(z,{}),!t&&e(q,{}),t&&e($,{})]})})},ht=()=>{const{modalNotas:o,isPhoneScreen:t}=m.exports.useContext(f),[n,r]=o;return e(x,{children:l(se,{open:n,onClose:()=>r(!1),maxWidth:"xl",fullWidth:!0,fullScreen:t,children:[e(ie,{onClose:()=>r(!1),children:l(g,{textTransform:"uppercase",display:"flex",flexDirection:"row",gap:1,alignItems:"center",children:[e(P,{}),"Notas"]})}),e(w,{}),e(pt,{}),e(w,{}),e(Ce,{children:e(O,{variant:"outlined",color:"inherit",onClick:()=>r(!1),children:"Cerrar"})})]})})},Mr=()=>{const{modalNotas:o}=m.exports.useContext(f),[,t]=o;return l(x,{children:[l(g,{className:ce.buttonIcon,onClick:()=>t(!0),variant:"body2",children:[e("span",{children:"Notas"})," ",e(qe,{badgeContent:0,color:"error",max:99,children:e(P,{})})]}),e(ht,{})]})};export{Mr as default};
