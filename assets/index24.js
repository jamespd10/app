var xo=Object.defineProperty,No=Object.defineProperties;var bo=Object.getOwnPropertyDescriptors;var Ye=Object.getOwnPropertySymbols;var fo=Object.prototype.hasOwnProperty,_o=Object.prototype.propertyIsEnumerable;var Je=(n,o,r)=>o in n?xo(n,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[o]=r,C=(n,o)=>{for(var r in o||(o={}))fo.call(o,r)&&Je(n,r,o[r]);if(Ye)for(var r of Ye(o))_o.call(o,r)&&Je(n,r,o[r]);return n},D=(n,o)=>No(n,bo(o));import{H as vo}from"./HeaderTitle.js";import{r as i,ag as oe,a as e,j as l,F as f,az as Co,q as eo,aw as ge,S as So,a2 as Y,A as Fo,aC as wo}from"./index.js";import{u as yo}from"./useFetcherEarly.js";import{N as $o}from"./NotFoundResults.js";import{L as oo}from"./Loader.js";import{a as Eo,s as d,d as Ao}from"./headerPlanilla.module.js";import{d as To,f as _,a as zo}from"./string.helper.js";import{S as P}from"./Stack.js";import{D as Z}from"./Divider.js";import{T as S}from"./Typography.js";import{P as ee}from"./Paper.js";import{d as Po}from"./FileDownload.js";import{d as Ro}from"./ScheduleSend.js";import{d as ko}from"./Assignment.js";import{F as Do,S as Io,a as Mo}from"./FabButtonAction.js";import{a as Ho}from"./ContentProvider.js";import{s as qo}from"./SpeedDial.module.js";import{B as Oo}from"./Backdrop.js";import{G as Bo}from"./Grow.js";import{d as Lo}from"./Edit.js";import{c as to,i as no,r as ao}from"./jsx-runtime_commonjs-proxy.js";import{u as U}from"./useModal.js";import"./jwt-decode.esm.js";import{s as Vo}from"./FileSaver.min.js";import{d as ae,c as I,h as pe,b as R,e as Ke,g as re,o as se,j as ro,a as k,F as le,u as A,C as jo}from"./array.js";import{d as Wo,n as ne,e as Qe,r as Xe}from"./regex.js";import{d as so}from"./Delete.js";import{D as j}from"./DecimalInput.js";import{I as io}from"./IconButton.js";import W from"./Modal2.js";import{a as he}from"./constantsLists.js";import{S as co}from"./SelectHookForm.js";import{T as X}from"./TextInput.js";import{F as Go}from"./FormControlLabel.js";import{C as lo}from"./Checkbox.js";import{d as Uo,a as Yo}from"./CheckBoxOutlineBlank.js";import{A as Jo}from"./AutocompleteServer.js";import{L as Ko}from"./ListItem.js";import{A as de}from"./Alert.js";import{B as ce}from"./Button.js";import{d as Qo}from"./AddBusiness.js";import Xo from"./InputAsociarNegocio.js";import{T as Zo}from"./TextEditor.js";import{I as et}from"./InputAdornment.js";import"./BootstrapTooltip.js";import{B as ot}from"./BackgroundLoader.js";import"./platform.js";import"./Grid.js";import"./extendSxProp.js";import"./react-is.production.min.js";import"./AssignmentRounded.js";import"./ButtonBase.js";import"./useIsFocusVisible.js";import"./useControlled.js";import"./Tooltip.js";import"./Portal.js";import"./isHostComponent.js";import"./createSvgIcon.js";import"./upperFirst.js";import"./CustomDecimal.js";import"./react-number-format.es.js";import"./Close2.js";import"./LoadingButton.js";import"./Modal.js";import"./Error.js";import"./Box.js";import"./TextField.js";import"./FormHelperText.js";import"./Menu.js";import"./List.js";import"./GlobalStyles.js";import"./MenuItem.js";import"./listItemIconClasses.js";import"./listItemTextClasses.js";import"./useFetch.js";import"./useHttpService.js";import"./Autocomplete.js";import"./Close.js";import"./Chip.js";import"./listItemButtonClasses.js";import"./ChipState.js";import"./index7.js";const w=i.exports.createContext({}),tt=({children:n})=>{const{id:o}=oe(),r=yo(`/admin/planillas/${o}`);return e(w.Provider,{value:r,children:n})},nt=()=>{const n=i.exports.useContext(w),[,o]=n;return l(f,{children:[l(P,{direction:"row",spacing:1,justifyContent:"space-between",divider:e(Z,{orientation:"vertical",flexItem:!0}),children:[l(S,{children:[e("strong",{children:"Usuario Elaborador"}),": ",o==null?void 0:o.user_elaborador]}),l(S,{children:[e("strong",{children:"Contrase\xF1a Elaborador"}),": ",o==null?void 0:o.password_elaborador]})]}),e(Z,{}),l(P,{direction:"row",spacing:1,justifyContent:"space-between",divider:e(Z,{orientation:"vertical",flexItem:!0}),children:[l(S,{children:[e("strong",{children:"Usuario Representante Legal"}),":"," ",o==null?void 0:o.user_representante]}),l(S,{children:[e("strong",{children:"Contrase\xF1a Representante Legal"}),":"," ",o==null?void 0:o.password_representante]})]})]})},at=()=>{const n=i.exports.useContext(w),[,o]=n,{setNegocioNota:r}=i.exports.useContext(Co);return i.exports.useEffect(()=>{(()=>{if(o){const a={id:o==null?void 0:o.id_negocio,tipo:o.tipo,nombre_negocio:o==null?void 0:o.nombre_negocio,ruta:o.ruta,ruc:o.ruc};r({negocio:a,mes:o.mes,tipo:"SIPE"})}})()},[o]),null},rt=i.exports.lazy(()=>eo(()=>import("./index54.js"),["assets/index54.js","assets/index.js","assets/index4.css","assets/jsx-runtime_commonjs-proxy.js","assets/createSvgIcon.js","assets/useControlled.js","assets/useIsFocusVisible.js","assets/BootstrapTooltip.js","assets/Tooltip.js","assets/Portal.js","assets/isHostComponent.js","assets/Grow.js","assets/array.js","assets/upperFirst.js","assets/useModal.js","assets/jwt-decode.esm.js","assets/IconButton.js","assets/ButtonBase.js","assets/Modal2.js","assets/Close2.js","assets/LoadingButton.js","assets/Backdrop.js","assets/Modal.js","assets/Paper.js","assets/Typography.js","assets/extendSxProp.js","assets/Button.js","assets/Error.js","assets/TextInput.js","assets/TextField.js","assets/FormHelperText.js","assets/react-is.production.min.js","assets/Menu.js","assets/List.js","assets/GlobalStyles.js","assets/Stack.js","assets/Divider.js","assets/Loader.js","assets/Grid.js","assets/Alert.js","assets/Close.js"])),st=i.exports.lazy(()=>eo(()=>import("./index55.js"),["assets/index55.js","assets/index7.css","assets/index.js","assets/index4.css","assets/Modal2.js","assets/Close2.js","assets/jsx-runtime_commonjs-proxy.js","assets/createSvgIcon.js","assets/useControlled.js","assets/useIsFocusVisible.js","assets/LoadingButton.js","assets/Backdrop.js","assets/Modal.js","assets/isHostComponent.js","assets/Portal.js","assets/Paper.js","assets/Typography.js","assets/extendSxProp.js","assets/Button.js","assets/ButtonBase.js","assets/IconButton.js","assets/Error.js","assets/array.js","assets/upperFirst.js","assets/regex.js","assets/useModal.js","assets/jwt-decode.esm.js","assets/PatronalInput.js","assets/TextInput.js","assets/TextField.js","assets/FormHelperText.js","assets/react-is.production.min.js","assets/Menu.js","assets/Grow.js","assets/List.js","assets/GlobalStyles.js","assets/CustomSipe.js","assets/index7.js","assets/Stack.js","assets/Alert.js","assets/Close.js"])),it=()=>{const n=i.exports.useContext(w),[,o,,,r]=n;return l(ee,{className:Eo.paper,variant:"outlined",children:[e(at,{}),l(P,{divider:e(Z,{}),direction:"column",spacing:1,children:[l(P,{direction:{xs:"column",md:"row"},justifyContent:"space-between",children:[l(P,{direction:"row",spacing:1,alignItems:"center",children:[l(S,{variant:"h5",color:"green",fontWeight:"bold",textTransform:"uppercase",children:[o==null?void 0:o.tipo," ",o==null?void 0:o.nombre_negocio]}),e(i.exports.Suspense,{fallback:e("div",{}),children:e(rt,{id:o==null?void 0:o.id_negocio,update:t=>r(C(C({},o),t))})})]}),l(P,{direction:"row",alignItems:"center",children:[l(S,{variant:"h5",fontWeight:"bold",textTransform:"uppercase",children:["MES:"," "]}),e(S,{variant:"h5",fontWeight:"bold",textTransform:"uppercase",color:"red",marginLeft:1,children:ge(o==null?void 0:o.mes,"MMMM yyyy")})]})]}),l(S,{component:P,spacing:1,direction:"row",children:[e("strong",{children:"Raz\xF3n social:"})," ",e("span",{children:o==null?void 0:o.nom_cliente})]}),l(S,{component:P,spacing:1,direction:"row",children:[e("strong",{children:"RUC:"})," ",e("span",{children:o==null?void 0:o.ruc}),e("strong",{children:"DV:"})," ",e("span",{children:o==null?void 0:o.dv}),e("strong",{children:"Ruta:"})," ",e("span",{children:o==null?void 0:o.ruta})]}),l(S,{component:P,spacing:1,direction:"row",children:[e("strong",{children:"N. Patronal:"})," ",e("span",{children:o==null?void 0:o.n_patronal}),e(i.exports.Suspense,{fallback:e("div",{}),children:e(st,{negocio:o.id_negocio,patronal:o==null?void 0:o.patronal_sipe,multer:t=>r(C(C({},o),t))})})]}),e(nt,{}),(o==null?void 0:o.notas)&&(o==null?void 0:o.notas)!==""&&l(P,{direction:"column",children:[e(S,{variant:"subtitle1",fontWeight:"bold",children:"Notas:"}),To(o==null?void 0:o.notas)]})]})]})},xe=()=>{const[,n]=i.exports.useContext(w),o=i.exports.useMemo(()=>n.negocios.flatMap(t=>t.contratos).map(t=>Number(t.indemnizacion)).some(t=>t>0),[]),r=i.exports.useMemo(()=>n.negocios.flatMap(t=>t.contratos).map(t=>Number(t.preaviso)).some(t=>t>0),[]);return{isIndemnizacion:o,isPreaviso:r}},ct=()=>{const{isIndemnizacion:n,isPreaviso:o}=xe();return e("thead",{children:l("tr",{children:[e("th",{className:d.header,children:"#"}),e("th",{className:d.header,children:"Nombre"}),e("th",{className:d.header,children:"C\xE9dula"}),e("th",{className:d.header,children:"Salario"}),e("th",{className:d.header,children:"D\xE9cimo"}),e("th",{className:d.header,children:"Vacaciones"}),e("th",{className:d.header,children:"Imp. Renta"}),e("th",{className:d.header,children:"Horas extras"}),e("th",{className:d.header,children:"Comisiones"}),n&&e("th",{className:d.header,children:"Indemnizaci\xF3n"}),o&&e("th",{className:d.header,children:"Preaviso"}),e("th",{className:d.header,children:"Total"})]})})},lt=()=>{const[,n]=i.exports.useContext(w),{isIndemnizacion:o,isPreaviso:r}=xe();return e(f,{children:n.negocios.flatMap(t=>t.contratos).map((t,a)=>l("tr",{className:d.row,children:[e("td",{className:d.column,children:a+1}),l("td",{className:d.column,children:[t.nombre," ",t.apellido]}),e("td",{className:d.column,children:t.identificacion}),e("td",{className:d.column,children:_(t.salario)}),e("td",{className:d.column,children:_(t.decimo)}),e("td",{className:d.column,children:_(t.vacaciones)}),e("td",{className:d.column,children:_(t.impuesto_renta)}),e("td",{className:d.column,children:_(t.horas_extras)}),e("td",{className:d.column,children:_(t.comisiones)}),o&&e("td",{className:d.column,children:_(t.indemnizacion)}),r&&e("td",{className:d.column,children:_(t.preaviso)}),e("td",{className:d.column,children:_(Number(t.salario)+Number(t.decimo)+Number(t.vacaciones)+Number(t.impuesto_renta)+Number(t.horas_extras)+Number(t.comisiones)+Number(t.indemnizacion)+Number(t.preaviso))})]},`${t.id_contrato}`))})},O=({name:n})=>{const[,o]=i.exports.useContext(w),r=i.exports.useMemo(()=>o.negocios.flatMap(t=>t.contratos).map(t=>Number(t[n])).reduce((t,a)=>t+a),[]);return e("td",{className:d.column,children:_(r)})},dt=()=>{const{isIndemnizacion:n,isPreaviso:o}=xe(),[,r]=i.exports.useContext(w),t=i.exports.useMemo(()=>r.negocios.flatMap(a=>a.contratos).map(a=>Number(a.salario)+Number(a.decimo)+Number(a.vacaciones)+Number(a.impuesto_renta)+Number(a.horas_extras)+Number(a.comisiones)+Number(a.indemnizacion)+Number(a.preaviso)).reduce((a,s)=>a+s),[]);return l("tr",{className:d.row,children:[e("td",{className:d.column}),e("td",{className:d.column,children:"Totales"}),e("td",{className:d.column}),e(O,{name:"salario"}),e(O,{name:"decimo"}),e(O,{name:"vacaciones"}),e(O,{name:"impuesto_renta"}),e(O,{name:"horas_extras"}),e(O,{name:"comisiones"}),n&&e(O,{name:"indemnizacion"}),o&&e(O,{name:"preaviso"}),e("td",{className:d.column,children:_(t)})]})},mt=()=>{const[,n]=i.exports.useContext(w),o=i.exports.useMemo(()=>n.negocios.flatMap(r=>r.contratos).map(r=>Number(r.salario)+Number(r.vacaciones)).reduce((r,t)=>r+t),[]);return e(f,{children:_(o)})},ut=()=>l(ee,{variant:"outlined",children:[e(S,{variant:"h5",textTransform:"uppercase",p:1,children:"Planilla - SIPE"}),e("div",{className:d.tableResponsive,children:l("table",{className:d.table,children:[e(ct,{}),l("tbody",{children:[e(lt,{}),e(dt,{})]})]})}),l(S,{variant:"h5",p:1,children:["Salarios + vacaciones ="," ",e("strong",{children:e(mt,{})})]})]}),Ne=n=>{const[,o]=i.exports.useContext(w),r=i.exports.useMemo(()=>o.negocios[n].contratos.map(a=>Number(a.indemnizacion)).some(a=>a>0),[]),t=i.exports.useMemo(()=>o.negocios[n].contratos.map(a=>Number(a.preaviso)).some(a=>a>0),[]);return{isIndemnizacion:r,isPreaviso:t}},pt=({index:n})=>{const{isIndemnizacion:o,isPreaviso:r}=Ne(n);return e("thead",{children:l("tr",{children:[e("th",{className:d.header,children:"#"}),e("th",{className:d.header,children:"Nombre"}),e("th",{className:d.header,children:"C\xE9dula"}),e("th",{className:d.header,children:"Salario"}),e("th",{className:d.header,children:"D\xE9cimo"}),e("th",{className:d.header,children:"Vacaciones"}),e("th",{className:d.header,children:"Imp. Renta"}),e("th",{className:d.header,children:"Horas extras"}),e("th",{className:d.header,children:"Comisiones"}),o&&e("th",{className:d.header,children:"Indemnizaci\xF3n"}),r&&e("th",{className:d.header,children:"Preaviso"}),e("th",{className:d.header,children:"Total"})]})})},ht=({index:n})=>{const[,o]=i.exports.useContext(w),{isIndemnizacion:r,isPreaviso:t}=Ne(n);return e(f,{children:o.negocios[n].contratos.map((a,s)=>l("tr",{className:d.row,children:[e("td",{className:d.column,children:s+1}),l("td",{className:d.column,children:[a.nombre," ",a.apellido]}),e("td",{className:d.column,children:a.identificacion}),e("td",{className:d.column,children:_(a.salario)}),e("td",{className:d.column,children:_(a.decimo)}),e("td",{className:d.column,children:_(a.vacaciones)}),e("td",{className:d.column,children:_(a.impuesto_renta)}),e("td",{className:d.column,children:_(a.horas_extras)}),e("td",{className:d.column,children:_(a.comisiones)}),r&&e("td",{className:d.column,children:_(a.indemnizacion)}),t&&e("td",{className:d.column,children:_(a.preaviso)}),e("td",{className:d.column,children:_(Number(a.salario)+Number(a.decimo)+Number(a.vacaciones)+Number(a.impuesto_renta)+Number(a.horas_extras)+Number(a.comisiones)+Number(a.indemnizacion)+Number(a.preaviso))})]},`${a.id_contrato}`))})},gt=({index:n})=>{const[,o]=i.exports.useContext(w),r=i.exports.useMemo(()=>o.negocios[n].contratos.map(t=>Number(t.salario)+Number(t.vacaciones)).reduce((t,a)=>t+a),[]);return e(f,{children:_(r)})},B=({index:n,name:o})=>{const[,r]=i.exports.useContext(w),t=i.exports.useMemo(()=>r.negocios[n].contratos.map(a=>Number(a[o])).reduce((a,s)=>a+s),[]);return e("td",{className:d.column,children:_(t)})},xt=({index:n})=>{const{isIndemnizacion:o,isPreaviso:r}=Ne(n),[,t]=i.exports.useContext(w),a=i.exports.useMemo(()=>t.negocios[n].contratos.map(s=>Number(s.salario)+Number(s.decimo)+Number(s.vacaciones)+Number(s.impuesto_renta)+Number(s.horas_extras)+Number(s.comisiones)+Number(s.indemnizacion)+Number(s.preaviso)).reduce((s,p)=>s+p),[]);return l("tr",{className:d.row,children:[e("td",{className:d.column}),e("td",{className:d.column,children:"Totales"}),e("td",{className:d.column}),e(B,{index:n,name:"salario"}),e(B,{index:n,name:"decimo"}),e(B,{index:n,name:"vacaciones"}),e(B,{index:n,name:"impuesto_renta"}),e(B,{index:n,name:"horas_extras"}),e(B,{index:n,name:"comisiones"}),o&&e(B,{index:n,name:"indemnizacion"}),r&&e(B,{index:n,name:"preaviso"}),e("td",{className:d.column,children:_(a)})]})},Nt=()=>{const[,n]=i.exports.useContext(w);return n.negocios.length===1?e(f,{}):l(f,{children:[e(S,{variant:"h4",textTransform:"uppercase",textAlign:"center",children:"Planilla seccionada por negocios"}),n.negocios.map((o,r)=>l(ee,{variant:"outlined",children:[l(S,{variant:"h5",textTransform:"uppercase",p:1,color:r===0?"red":"orange",children:[o.tipo," ",o.nombre]}),e("div",{className:d.tableResponsive,children:l("table",{className:d.table,children:[e(pt,{index:r}),l("tbody",{children:[e(ht,{index:r}),e(xt,{index:r})]})]})}),l(S,{variant:"h5",p:1,children:["Salarios + vacaciones ="," ",e("strong",{children:e(gt,{index:r})})]})]},`${o.id_negocio}`))]})},bt=({acciones:n,icon:o,title:r})=>{const[t,a]=i.exports.useState(!1),s=()=>a(!0),p=()=>a(!1),{contentScroll:u}=i.exports.useContext(Ho),[,,,c]=u;return i.exports.useEffect(()=>{(()=>{t?document.body.style.overflowY="hidden":document.body.style.overflowY="auto"})()},[t]),i.exports.useEffect(()=>{(()=>{c.current&&(c.current.style.marginBottom="50px")})()},[]),n.length===1?e(Do,{text:n[0].title,icon:n[0].icon,onClick:()=>n[0].onClick()}):l("div",{children:[e(Oo,{open:t,sx:{zIndex:m=>m.zIndex.modal}}),e(Bo,{in:!0,timeout:700,children:e(Io,{className:qo.speedDial,ariaLabel:"Custom SpeedDial",FabProps:{variant:"extended",size:"medium"},sx:{zIndex:m=>m.zIndex.modal},icon:l(P,{direction:"row",spacing:1,children:[o||e(ko,{}),r||"Acciones"]}),onClose:p,onOpen:s,open:t,children:n.slice().reverse().map((m,x)=>e(Mo,{icon:e(So,{component:m.icon}),tooltipTitle:m.title,tooltipOpen:!0,onClick:()=>{p(),m.onClick()}},m.title))})})]})};var be={},ft=no.exports;Object.defineProperty(be,"__esModule",{value:!0});var mo=be.default=void 0,_t=ft(to),vt=ao,Ct=(0,_t.default)((0,vt.jsx)("path",{d:"m14.5 14.2 2.9 1.7-.8 1.3L13 15v-5h1.5v4.2zM22 14c0 4.41-3.59 8-8 8-2.02 0-3.86-.76-5.27-2H4c-1.15 0-2-.85-2-2V9c0-1.12.89-1.96 2-2v-.5C4 4.01 6.01 2 8.5 2c2.34 0 4.24 1.79 4.46 4.08.34-.05.69-.08 1.04-.08 4.41 0 8 3.59 8 8zM6 7h5v-.74C10.88 4.99 9.8 4 8.5 4 7.12 4 6 5.12 6 6.5V7zm14 7c0-3.31-2.69-6-6-6s-6 2.69-6 6 2.69 6 6 6 6-2.69 6-6z"}),"LockClock");mo=be.default=Ct;const H=i.exports.createContext({}),St=({children:n})=>{const[o,r]=i.exports.useState(!1),t=m=>r(m),a=U(),s=U(),p=U(),u=U(),c=Y();return e(H.Provider,{value:{editing:o,setEditing:t,modalDownload:a,modalEditar:s,modalGenerarPassword:p,modalSend:u,fetchDownload:c},children:n})},Ft=()=>{const{id:n}=oe(),{fetchDownload:o,modalDownload:r}=i.exports.useContext(H),[,t]=o,{setOpen:a}=r,[,s]=i.exports.useContext(w),p=i.exports.useMemo(()=>`PLANILLA-${ge(s==null?void 0:s.mes,"MMMM-yyyy")}-${(s==null?void 0:s.tipo)||""} ${(s==null?void 0:s.nombre_negocio)||""}`.replaceAll(" ","-").toUpperCase(),[s]);return()=>{t(`/admin/planillas/${n}/generar`,{isBlob:!0}).then(c=>{c.data&&Vo(c.data,`${p}.xlsx`)}).finally(()=>{a()})}},wt=()=>{const[,n]=i.exports.useContext(w),o=i.exports.useContext(H),{modalEditar:r,modalGenerarPassword:t,modalSend:a}=o,{setOpen:s}=r,{authState:p}=i.exports.useContext(Fo),{tipo:u}=p,c=Ft();return e(f,{children:e(bt,{acciones:[...u&&["Super","Administrador"].includes(u)?[{title:"Generar contrase\xF1a",icon:mo,onClick:()=>t.setOpen()}]:[],{title:"Generar SIPE",icon:Po,onClick:()=>c()},...n.fecha_send_sipe?[]:[{title:"Marcar como enviada al SIPE",icon:Ro,onClick:()=>a.setOpen()}],...Boolean(Number(n.can_edit))?[{title:"Editar",icon:Lo,onClick:()=>s()}]:[]]})})},L=ae().typeError("Ingresar un valor").positive("La cantidad del salario debe ser positiva").min(0,"La cantidad del salario debe ser mayor a 0").max(9e10,"M\xE1ximo 10 d\xEDgitos").required("Ingresar un valor").test("check-decimal","Favor ingresar m\xE1ximo dos decimales",n=>!!(n===0||n&&n.toString().match(Wo))),yt=I().shape({mes:pe().typeError("Favor ingresar el mes de la planilla a realizar").required("Favor ingresar el mes de la planilla a realizar"),notas:R().trim().nullable(!0).notRequired(),negocios:Ke().of(I().shape({id_negocio:ae().typeError("Favor ingresar el negocio").positive("Favor ingresar el negocio").integer("Favor ingresar el negocio").required("Favor ingresar el negocio"),contratos:Ke().of(I().shape({salario:L,decimo:L,vacaciones:L,impuesto_renta:L,horas_extras:L,comisiones:L,preaviso:L,indemnizacion:L,id_contrato:ae().typeError("El id es requerido").required("El id es requerido").positive("El id debe ser un n\xFAmero positivo").integer("El id debe ser un n\xFAmero entero")})).min(1,"Favor ingresar al menos un empleado")})).min(1,"Favor ingresar al menos un negocio")}),J=i.exports.createContext({}),$t=({children:n})=>{const o=i.exports.useContext(w),[,r]=o,t=i.exports.useMemo(()=>["4","8","12"].includes(ge(r.mes,"M")),[]),a=re({mode:"onSubmit",resolver:se(yt),defaultValues:{notas:zo(r.notas),mes:r.mes,negocios:r.negocios.map(c=>D(C({},c),{contratos:c.contratos.map(m=>D(C({},m),{complete_name:`${m.nombre} ${m.apellido}`,identificacion:m.identificacion}))}))}}),s=ro({control:a.control,name:"negocios"}),p=k({control:a.control,name:"negocios"}),u=Y();return e(le,D(C({},a),{children:e(J.Provider,{value:{fieldsNegocios:s,negocios:p,isDecimo:t,mainNegocioId:r.id_negocio,clienteId:r.id_cliente,fetcherSaveData:u},children:n})}))},Et="_paperTables_7zus3_1",At="_fechaTables_7zus3_5",Tt="_paperNotas_7zus3_11",zt="_tableResponsive_7zus3_15",Pt="_table_7zus3_15",Rt="_lastedTableResponsive_7zus3_25",kt="_header_7zus3_30",Dt="_column_7zus3_50",It="_row_7zus3_57",Mt="_columnClick_7zus3_71",Ht="_columnClickEdit_7zus3_76",qt="_icon_7zus3_106",Ot="_inputDecimal_7zus3_110";var h={paperTables:Et,fechaTables:At,paperNotas:Tt,tableResponsive:zt,table:Pt,lastedTableResponsive:Rt,header:kt,column:Dt,row:It,columnClick:Mt,columnClickEdit:Ht,icon:qt,inputDecimal:Ot};const V=({negocioIndex:n,name:o})=>{const{control:r}=A(),t=k({control:r,name:`negocios.${n}.contratos`}),a=i.exports.useMemo(()=>t&&t.length>0?t.map(s=>Number(s[o]||0)).reduce((s,p)=>s+p):0,[t]);return e(f,{children:_(a)})},Bt=({negocioIndex:n})=>{const{control:o}=A(),r=k({control:o,name:`negocios.${n}.contratos`}),t=i.exports.useMemo(()=>r&&r.length>0?r.map(a=>Number(a.salario||0)+Number(a.decimo||0)+Number(a.vacaciones||0)+Number(a.impuesto_renta||0)+Number(a.horas_extras||0)+Number(a.comisiones||0)+Number(a.indemnizacion||0)+Number(a.preaviso||0)).reduce((a,s)=>a+s):0,[r]);return e(f,{children:_(t)})},Lt=({negocioIndex:n})=>{const{control:o}=A(),r=k({control:o,name:`negocios.${n}.contratos`});return i.exports.useMemo(()=>r&&r.length>0&&r.map(a=>Number(a.vacaciones||0)).reduce((a,s)=>a+s)>0,[r])?l(f,{children:[e("td",{className:h.column,children:e(V,{name:"indemnizacion",negocioIndex:n})}),e("td",{className:h.column,children:e(V,{name:"preaviso",negocioIndex:n})})]}):e(f,{})},Vt=({negocioIndex:n})=>l("tr",{className:h.row,children:[e("td",{className:h.column}),e("td",{className:h.column,children:"Totales"}),e("td",{className:h.column}),e("td",{className:h.column,children:e(V,{name:"salario",negocioIndex:n})}),e("td",{className:h.column,children:e(V,{name:"decimo",negocioIndex:n})}),e("td",{className:h.column,children:e(V,{name:"vacaciones",negocioIndex:n})}),e("td",{className:h.column,children:e(V,{name:"impuesto_renta",negocioIndex:n})}),e("td",{className:h.column,children:e(V,{name:"horas_extras",negocioIndex:n})}),e("td",{className:h.column,children:e(V,{name:"comisiones",negocioIndex:n})}),e(Lt,{negocioIndex:n}),e("td",{colSpan:2,className:h.column,children:e(Bt,{negocioIndex:n})})]}),jt=({negocioIndex:n,contratoIndex:o})=>{const{control:r}=A(),t=k({control:r,name:`negocios.${n}.contratos.${o}`}),a=i.exports.useMemo(()=>Number(t.salario||0)+Number(t.decimo||0)+Number(t.vacaciones||0)+Number(t.impuesto_renta||0)+Number(t.horas_extras||0)+Number(t.comisiones||0)+Number(t.indemnizacion||0)+Number(t.preaviso||0),[t]);return e("span",{children:_(a)})},Wt=({negocioIndex:n})=>{const{control:o}=A(),r=k({control:o,name:`negocios.${n}.contratos`});return i.exports.useMemo(()=>r&&r.length>0&&r.map(a=>Number(a.vacaciones||0)).reduce((a,s)=>a+s)>0,[r])?l(f,{children:[e("th",{className:h.header,children:"Indemnizaci\xF3n"}),e("th",{className:h.header,children:"Preaviso"})]}):e(f,{})},Gt=({negocioIndex:n})=>e("thead",{children:l("tr",{children:[e("th",{className:h.header,children:"#"}),e("th",{className:h.header,children:"Nombre"}),e("th",{className:h.header,children:"C\xE9dula"}),e("th",{className:h.header,children:"Salario"}),e("th",{className:h.header,children:"D\xE9cimo"}),e("th",{className:h.header,children:"Vacaciones"}),e("th",{className:h.header,children:"Imp. Renta"}),e("th",{className:h.header,children:"Horas extras"}),e("th",{className:h.header,children:"Comisiones"}),e(Wt,{negocioIndex:n}),e("th",{className:h.header,children:"Total"}),e("th",{className:h.header,children:"Remover"})]})}),Ut=({negocioIndex:n,contratoIndex:o})=>{var u,c,m,x,b,g,N,v,F,T,z,y,M,$,E,q,G,te;const{control:r,formState:t}=A(),{errors:a}=t,s=k({control:r,name:`negocios.${n}.contratos`});return i.exports.useMemo(()=>s&&s.length>0&&s.map(Q=>Number(Q.vacaciones||0)).reduce((Q,ie)=>Q+ie)>0,[s])?l(f,{children:[e("td",{className:h.column,children:e(j,{className:h.inputDecimal,name:`negocios.${n}.contratos.${o}.indemnizacion`,label:"Indemnizaci\xF3n",fullWidth:!0,error:!!((x=(m=(c=(u=a==null?void 0:a.negocios)==null?void 0:u[Number(n)])==null?void 0:c.contratos)==null?void 0:m[Number(o)])!=null&&x.indemnizacion),helperText:(F=(v=(N=(g=(b=a==null?void 0:a.negocios)==null?void 0:b[Number(n)])==null?void 0:g.contratos)==null?void 0:N[Number(o)])==null?void 0:v.indemnizacion)==null?void 0:F.message,size:"small"})}),e("td",{className:h.column,children:e(j,{className:h.inputDecimal,name:`negocios.${n}.contratos.${o}.preaviso`,label:"Preaviso",fullWidth:!0,error:!!((M=(y=(z=(T=a==null?void 0:a.negocios)==null?void 0:T[Number(n)])==null?void 0:z.contratos)==null?void 0:y[Number(o)])!=null&&M.preaviso),helperText:(te=(G=(q=(E=($=a==null?void 0:a.negocios)==null?void 0:$[Number(n)])==null?void 0:E.contratos)==null?void 0:q[Number(o)])==null?void 0:G.preaviso)==null?void 0:te.message,size:"small"})})]}):e(f,{})},Yt=({negocioIndex:n,contratoIndex:o})=>{var u,c,m,x,b,g,N,v,F;const{control:r,setValue:t,formState:a}=A(),{errors:s}=a,p=k({control:r,name:`negocios.${n}.contratos.${o}.salario`});return wo(()=>{(()=>{p&&p!==""&&Number(p)>=800?t(`negocios.${n}.contratos.${o}.impuesto_renta`,""):t(`negocios.${n}.contratos.${o}.impuesto_renta`,0)})()},[p]),e(j,{className:h.inputDecimal,name:`negocios.${n}.contratos.${o}.impuesto_renta`,label:"Imp. Renta",fullWidth:!0,error:!!((x=(m=(c=(u=s==null?void 0:s.negocios)==null?void 0:u[Number(n)])==null?void 0:c.contratos)==null?void 0:m[Number(o)])!=null&&x.impuesto_renta),helperText:(F=(v=(N=(g=(b=s==null?void 0:s.negocios)==null?void 0:b[Number(n)])==null?void 0:g.contratos)==null?void 0:N[Number(o)])==null?void 0:v.impuesto_renta)==null?void 0:F.message,size:"small"})},K=i.exports.createContext({}),Jt=({children:n,clienteId:o,mainNegocioId:r,negocioIndex:t,isDecimo:a})=>{const s=U(),{control:p}=A(),{fields:u,remove:c,append:m,update:x}=ro({control:p,name:`negocios.${t}.contratos`});return e(K.Provider,{value:{modalAgregarContrato:s,clienteId:o,mainNegocioId:r,negocioIndex:t,fields:u,remove:c,append:m,update:x,isDecimo:a},children:n})},me=i.exports.createContext({}),Kt=({children:n})=>{const[o,r]=i.exports.useState(null),t=i.exports.useCallback((s,p)=>{r({negocioIndex:s,contratoIndex:p})},[]),a=i.exports.useCallback(()=>r(null),[]);return e(me.Provider,{value:{negocioContrato:o,setNegocioContrato:t,setNullNegocioContrato:a},children:n})},Qt=n=>{const{negocioIndex:o}=n,{formState:r}=A(),{errors:t}=r,{fields:a,remove:s}=i.exports.useContext(K),{setNegocioContrato:p}=i.exports.useContext(me);return e("div",{className:h.tableResponsive,children:l("table",{className:h.table,children:[e(Gt,{negocioIndex:o}),l("tbody",{children:[a==null?void 0:a.map((u,c)=>{var m,x,b,g,N,v,F,T,z,y,M,$,E,q,G,te,Q,ie,ve,Ce,Se,Fe,we,ye,$e,Ee,Ae,Te,ze,Pe,Re,ke,De,Ie,Me,He,qe,Oe,Be,Le,Ve,je,We,Ge,Ue;return l("tr",{className:h.row,children:[e("td",{className:h.column,children:c+1}),l("td",{className:`${h.column} ${h.columnClick}`,onClick:()=>p(Number(o),c),children:[e("div",{className:h.columnClickEdit,children:e("span",{})}),l("span",{children:[u.nombre," ",u.apellido]})]}),e("td",{className:h.column,children:e("span",{children:u.identificacion})}),e("td",{className:h.column,children:e(j,{className:h.inputDecimal,name:`negocios.${o}.contratos.${c}.salario`,label:"Salario",fullWidth:!0,error:!!((g=(b=(x=(m=t==null?void 0:t.negocios)==null?void 0:m[Number(o)])==null?void 0:x.contratos)==null?void 0:b[c])!=null&&g.salario),helperText:(z=(T=(F=(v=(N=t==null?void 0:t.negocios)==null?void 0:N[Number(o)])==null?void 0:v.contratos)==null?void 0:F[c])==null?void 0:T.salario)==null?void 0:z.message,size:"small"})}),e("td",{className:h.column,children:e(j,{className:h.inputDecimal,name:`negocios.${o}.contratos.${c}.decimo`,label:"D\xE9cimo",fullWidth:!0,error:!!((E=($=(M=(y=t==null?void 0:t.negocios)==null?void 0:y[Number(o)])==null?void 0:M.contratos)==null?void 0:$[c])!=null&&E.decimo),helperText:(ie=(Q=(te=(G=(q=t==null?void 0:t.negocios)==null?void 0:q[Number(o)])==null?void 0:G.contratos)==null?void 0:te[c])==null?void 0:Q.decimo)==null?void 0:ie.message,size:"small"})}),e("td",{className:h.column,children:e(j,{className:h.inputDecimal,name:`negocios.${o}.contratos.${c}.vacaciones`,label:"Vacaciones",fullWidth:!0,error:!!((Fe=(Se=(Ce=(ve=t==null?void 0:t.negocios)==null?void 0:ve[Number(o)])==null?void 0:Ce.contratos)==null?void 0:Se[c])!=null&&Fe.vacaciones),helperText:(Ae=(Ee=($e=(ye=(we=t==null?void 0:t.negocios)==null?void 0:we[Number(o)])==null?void 0:ye.contratos)==null?void 0:$e[c])==null?void 0:Ee.vacaciones)==null?void 0:Ae.message,size:"small"})}),e("td",{className:h.column,children:e(Yt,{negocioIndex:o,contratoIndex:c})}),e("td",{className:h.column,children:e(j,{className:h.inputDecimal,name:`negocios.${o}.contratos.${c}.horas_extras`,label:"Horas extras",fullWidth:!0,error:!!((Re=(Pe=(ze=(Te=t==null?void 0:t.negocios)==null?void 0:Te[Number(o)])==null?void 0:ze.contratos)==null?void 0:Pe[c])!=null&&Re.horas_extras),helperText:(He=(Me=(Ie=(De=(ke=t==null?void 0:t.negocios)==null?void 0:ke[Number(o)])==null?void 0:De.contratos)==null?void 0:Ie[c])==null?void 0:Me.horas_extras)==null?void 0:He.message,size:"small"})}),e("td",{className:h.column,children:e(j,{className:h.inputDecimal,name:`negocios.${o}.contratos.${c}.comisiones`,label:"Comisiones",fullWidth:!0,error:!!((Le=(Be=(Oe=(qe=t==null?void 0:t.negocios)==null?void 0:qe[Number(o)])==null?void 0:Oe.contratos)==null?void 0:Be[c])!=null&&Le.comisiones),helperText:(Ue=(Ge=(We=(je=(Ve=t==null?void 0:t.negocios)==null?void 0:Ve[Number(o)])==null?void 0:je.contratos)==null?void 0:We[c])==null?void 0:Ge.comisiones)==null?void 0:Ue.message,size:"small"})}),e(Ut,{negocioIndex:o,contratoIndex:c}),e("td",{className:h.column,children:e(jt,{negocioIndex:o,contratoIndex:c})}),e("td",{className:`${h.column} ${h.icon}`,children:e(io,{color:"error",onClick:()=>s(c),children:e(so,{})})})]},`${u.id}`)}),e(Vt,{negocioIndex:o})]})]})})},Xt=n=>{const{negocioIndex:o}=n,{control:r}=A(),t=k({control:r,name:`negocios.${o}.contratos`}),a=i.exports.useMemo(()=>t&&t.length>0?t.map(s=>Number(s.salario||0)+Number(s.vacaciones||0)).reduce((s,p)=>s+p):0,[t]);return l(S,{variant:"h5",children:["Salarios + Vacaciones = ",e("strong",{children:_(a)})," "]})},Zt=(n,o)=>{const[,r,,,,t]=o,{negocios:a}=i.exports.useContext(J),{append:s,mainNegocioId:p,clienteId:u,modalAgregarContrato:c,isDecimo:m}=i.exports.useContext(K),{setHide:x}=c;return{handleAppenContrato:async g=>{if(g.seleccion==="old"){const N=a.flatMap(F=>F.contratos);(N==null?void 0:N.find(F=>Number(F.id_contrato)===Number(g.empleado_selected.id)))?n.setError("empleado_selected.id",{type:"manual",message:"El empleado ya existe en la lista actual. Favor seleccionar otro o crear uno nuevo."}):(s({salario:"",decimo:m?"":0,vacaciones:0,preaviso:0,indemnizacion:0,impuesto_renta:0,id_contrato:Number(g.empleado_selected.id),nombre:g.empleado_selected.nombre||"",apellido:g.empleado_selected.apellido||"",complete_name:g.empleado_selected.complete_name||"",identificacion:g.empleado_selected.identificacion||"",horas_extras:0,comisiones:0,tipo_identificacion:g.empleado_selected.tipo_identificacion||"",seguro:g.empleado_selected.seguro||g.empleado_selected.identificacion||"",conyuge_no_trabaja:g.empleado_selected.conyuge_no_trabaja}),x(),n.reset({seleccion:""}),t())}else{const N=await r(`/admin/contratos/${p}/${u}/add-contrato-planilla`,{method:"POST",data:D(C({},g.new_empleado),{negocio:p})});N.data&&(s({salario:"",decimo:m?"":0,vacaciones:0,preaviso:0,indemnizacion:0,impuesto_renta:0,id_contrato:N.data.id,nombre:g.new_empleado.nombre||"",apellido:g.new_empleado.apellido||"",complete_name:`${g.new_empleado.nombre} ${g.new_empleado.apellido}`,identificacion:g.new_empleado.identificacion||"",horas_extras:0,comisiones:0,tipo_identificacion:g.new_empleado.tipoIdentificacion||"",seguro:g.new_empleado.seguro||g.new_empleado.identificacion||"",conyuge_no_trabaja:g.new_empleado.conyuge_no_trabaja}),x(),n.reset({seleccion:""}),t())}}}},uo=I().shape({seleccion:R().trim().required("Favor seleccionar la forma de agregar al empleado").test("check","Favor seleccionar solo de la lista",n=>!!(n&&["new","old"].includes(n))),empleado_selected:I().nullable().when("seleccion",{is:"old",then:I().shape({id:ae().typeError("Favor seleccionar el empleado").positive("Favor seleccionar el empleado").integer("Favor seleccionar el empleado"),nombre:R().trim().required("Favor de ingresar el apellido").matches(ne,"Favor ingresar solo letras del abecedario"),apellido:R().trim().required("Favor de ingresar el apellido").matches(ne,"Favor ingresar solo letras del abecedario"),complete_name:R().trim().required("Favor de ingresar el apellido").matches(ne,"Favor ingresar solo letras del abecedario"),identificacion:R().trim().required("Favor seleccionar el empleado"),fecha_ini:pe().transform((n,o)=>o===""?null:n).typeError("Favor seleccionar el empleado").nullable(!0).default(null).notRequired(),dv:R().typeError("Favor seleccionar el empleado").nullable(!0).notRequired().test("check","Favor ingresar un n\xFAmero de dos decimales",n=>!!(!n||n&&n.match(Qe)))}).typeError("Favor seleccionar el empleado")}),new_empleado:I().typeError("Favor ingresar el empleado").nullable().when("seleccion",{is:"new",then:I().shape({nombre:R().trim().required("Favor de ingresar el nombre").matches(ne,"Favor ingresar solo letras del abecedario"),apellido:R().trim().required("Favor de ingresar el apellido").matches(ne,"Favor ingresar solo letras del abecedario"),dv:R().trim().nullable(!0).notRequired().test("check","Favor ingresar un n\xFAmero de dos decimales",n=>!!(!n||n&&n.match(Qe))),tipoIdentificacion:R().trim().required("Favor de ingresar el tipo de identificaci\xF3n").test("is-identificacion","Favor de ingresar un tipo de identificaci\xF3n v\xE1lido: "+[...he,"C\xE9dula No verificada"].join(", "),n=>[...he,"C\xE9dula No verificada"].includes(n)),identificacion:R().trim().required("Favor de ingresar la c\xE9dula o pasaporte").matches(Xe,"Favor de ingresar solo n\xFAmeros, letras en may\xFAscula y/o guiones (-)"),seguro:R().trim().nullable(!0).notRequired().test("check-seguro","Favor de ingresar solo n\xFAmeros, letras en may\xFAscula y/o guiones (-)",n=>!!(!n||n&&new RegExp(Xe).test(n))),fecha_ini:pe().transform((n,o)=>o===""?null:n).typeError("Favor de seleccionar la fecha de inicio del empleado").nullable(!0).default(null).notRequired()})})}),po=()=>{var u,c,m,x,b,g,N,v,F,T,z,y,M,$,E,q;const n=A(),{register:o,formState:r,control:t,setValue:a}=n,{errors:s}=r,p=k({control:t,name:"new_empleado.conyuge_no_trabaja"});return l(P,{spacing:1,style:{marginTop:10},children:[e(co,{control:t,label:"Tipo de identificaci\xF3n",options:[...he,"C\xE9dula No verificada"],error:!!((u=s==null?void 0:s.new_empleado)!=null&&u.tipoIdentificacion),helperText:(m=(c=s==null?void 0:s.new_empleado)==null?void 0:c.tipoIdentificacion)==null?void 0:m.message,name:"new_empleado.tipoIdentificacion",required:!0}),e(X,C({label:"Nombre",fullWidth:!0,error:!!((x=s==null?void 0:s.new_empleado)!=null&&x.nombre),helperText:(g=(b=s==null?void 0:s.new_empleado)==null?void 0:b.nombre)==null?void 0:g.message,required:!0},o("new_empleado.nombre"))),e(X,C({label:"Apellido",fullWidth:!0,error:!!((N=s==null?void 0:s.new_empleado)!=null&&N.apellido),helperText:(F=(v=s==null?void 0:s.new_empleado)==null?void 0:v.apellido)==null?void 0:F.message,required:!0},o("new_empleado.apellido"))),e(X,C({label:"Identificaci\xF3n",fullWidth:!0,error:!!((T=s==null?void 0:s.new_empleado)!=null&&T.identificacion),helperText:(M=(y=(z=s==null?void 0:s.new_empleado)==null?void 0:z.identificacion)==null?void 0:y.message)!=null?M:"C\xE9dula o Pasaporte",required:!0},o("new_empleado.identificacion"))),e(X,C({label:"Seguro social",fullWidth:!0,error:!!(($=s==null?void 0:s.new_empleado)!=null&&$.seguro),helperText:(q=(E=s==null?void 0:s.new_empleado)==null?void 0:E.seguro)==null?void 0:q.message},o("new_empleado.seguro"))),e(Go,{control:e(lo,{checked:p===4,onChange:G=>{a("new_empleado.conyuge_no_trabaja",G.target.checked?4:1)}}),label:"Casado(a) y c\xF3nyuge no trabaja"})]})},en=()=>{const{mainNegocioId:n,clienteId:o}=i.exports.useContext(K),{control:r,formState:t}=A(),{errors:a}=t;return e(jo,{control:r,name:"empleado_selected",render:({field:s})=>{var p,u,c,m,x;return e(Jo,D(C({},s),{urlFetch:`/admin/contratos/${n}/${o}/input-planilla`,enableFirst:!0,onChange:(b,g)=>s.onChange(g),inputProps:{label:"Empleado",helperText:(u=(p=a==null?void 0:a.empleado_selected)==null?void 0:p.id)==null?void 0:u.message,error:!!((x=(m=(c=t.errors)==null?void 0:c.empleado_selected)==null?void 0:m.id)!=null&&x.message)},fullWidth:!0,isOptionEqualToValue:(b,g)=>b.id===g.id,getOptionLabel:b=>b.complete_name||"",renderOption:(b,g,{selected:N})=>l(Ko,D(C({},b),{style:{textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[e(lo,{icon:e(Uo,{}),checkedIcon:e(Yo,{}),style:{marginRight:8},checked:N}),l("div",{style:{display:"flex",flexDirection:"column",textTransform:"uppercase"},children:[l(S,{variant:"body1",children:[g.nombre," ",g.apellido]}),e(S,{variant:"body2",children:g.identificacion})]})]}))}))}})},on=()=>{var a;const{control:n,formState:o}=A(),{errors:r}=o,t=k({control:n,name:"seleccion"});return l(f,{children:[e(co,{label:"Selecci\xF3n",options:["Insertar nuevo empleado","Empleado de la lista actual de contratos"],values:["new","old"],error:!!(r!=null&&r.seleccion),helperText:(a=r==null?void 0:r.seleccion)==null?void 0:a.message,name:"seleccion",required:!0}),t==="old"&&e("div",{style:{marginTop:10},children:e(en,{})}),t==="new"&&e(po,{})]})},Ze=()=>{const n=i.exports.useContext(K),{modalAgregarContrato:o}=n,{modalState:r,setHide:t}=o,a=re({mode:"all",resolver:se(uo)}),s=Y(),{handleAppenContrato:p}=Zt(a,s),[,,,u,,c]=s,m=i.exports.useCallback(()=>{t(),c(),a.reset({seleccion:""})},[]);return e(W,{state:r,title:"Agregar Empleado",setHide:()=>m(),cancelBotton:{text:"Cerrar",actionFunction:()=>m()},actionButton:{text:"Agregar",actionFunction:a.handleSubmit(p)},children:l(le,D(C({},a),{children:[u&&e(de,{severity:"error",variant:"outlined",sx:{width:"100%",mb:2},children:u==null?void 0:u.message}),e(on,{})]}))})},tn=n=>{const{reset:o}=n,r=i.exports.useContext(me),{negocioContrato:t,setNullNegocioContrato:a}=r,{control:s}=A(),p=k({control:s,name:"negocios"}),[u,c,m,x,,b]=Y(),{update:g}=i.exports.useContext(K);i.exports.useEffect(()=>{(()=>{if(t){const{negocioIndex:T,contratoIndex:z}=t,y=p[T].contratos[z];o({seleccion:"new",new_empleado:D(C({},y),{tipoIdentificacion:y.tipo_identificacion,seguro:y.seguro===y.identificacion?"":y.seguro})})}else o({seleccion:"new",new_empleado:{}})})()},[t]);const N=F=>{const{negocioIndex:T,contratoIndex:z}=t,y=p[T].contratos[z];c(`/admin/contratos/${y.id_contrato}/edit-planilla`,{method:"POST",data:F.new_empleado}).then(M=>{if(M.data){const $=F.new_empleado,E=y;E.apellido=$.apellido||"",E.nombre=$.nombre||"",E.complete_name=`${$.nombre} ${$.apellido}`,E.tipo_identificacion=$.tipoIdentificacion||"",E.identificacion=$.identificacion||"",E.seguro=$.seguro||"",E.conyuge_no_trabaja=$.conyuge_no_trabaja,g(z,C({},E)),o({seleccion:"new",new_empleado:{}}),a(),b()}})};return{handleSetHide:i.exports.useCallback(()=>{a(),b(),o({seleccion:"new",new_empleado:{}})},[]),onSubmit:N,isLoading:u,response:m,error:x}},nn=()=>{const n=i.exports.useContext(me),{negocioContrato:o}=n,r=re({mode:"all",resolver:se(uo)}),{handleSubmit:t}=r,a=tn(r),{handleSetHide:s,onSubmit:p,isLoading:u}=a,{response:c,error:m}=a;return l(W,{state:o!==null,setHide:()=>s(),title:"Editar Empleado",actionButton:{text:"Guardar",actionFunction:t(p),isLoading:u},children:[(c||m)&&e(de,{variant:"outlined",severity:c?"success":"error",children:(c==null?void 0:c.message)||(m==null?void 0:m.message)}),e(le,D(C({},r),{children:e(po,{})}))]})},an=n=>{const{fieldsNegocios:o}=i.exports.useContext(J),{remove:r}=o,{negocioIndex:t}=n,{control:a}=A(),s=k({control:a,name:`negocios.${t}`});return s.contratos&&s.contratos.length>0?l(f,{children:[e(Qt,{negocioIndex:t}),e(Xt,{negocioIndex:t}),e(Ze,{}),e(nn,{})]}):l(de,{severity:"error",action:t!==0&&t!=="0"&&e(ce,{variant:"contained",color:"error",size:"small",onClick:()=>r(Number(t)),startIcon:e(so,{}),children:"Remover negocio"}),children:[e(S,{fontWeight:"bold",children:"Favor ingresar al menos un empleado"}),e(Ze,{})]})},fe=i.exports.createContext({}),rn=({children:n})=>{const o=U();return e(fe.Provider,{value:{modalAgregarNegocio:o},children:n})},sn="_divBtnAgregar_1mbg8_1",cn="_btnAgregar_1mbg8_9";var ue={divBtnAgregar:sn,btnAgregar:cn};const ln=()=>{const{modalAgregarNegocio:n}=i.exports.useContext(fe),{setOpen:o}=n,{modalAgregarContrato:r}=i.exports.useContext(K),{setOpen:t}=r;return l("div",{className:ue.divBtnAgregar,children:[e(ce,{className:ue.btnAgregar,variant:"contained",size:"small",onClick:()=>t(),startIcon:e(Ao,{}),children:"Agregar empleado"}),e(ce,{className:ue.btnAgregar,variant:"contained",color:"success",size:"small",onClick:()=>o(),startIcon:e(Qo,{}),children:"Agregar negocio"})]})},dn=I().shape({negocio_cobrar:I().shape({id:ae().typeError("Favor ingresar el id").integer("Favor ingresar el negocio").positive("Favor ingresar el negocio").required("Favor ingresar el id")}).typeError("Favor seleccionar un negocio").required("Favor seleccionar un negocio")}),mn=(n,o)=>{const{fieldsNegocios:r}=i.exports.useContext(J),{append:t}=r,{control:a}=A(),s=k({control:a,name:"negocios"}),p=()=>{o(),n.reset({})};return{handleAppendNegocio:c=>{s.findIndex(x=>Number(x.id_negocio)===Number(c.negocio_cobrar.id))===-1?(t({id_negocio:c.negocio_cobrar.id,id_cliente:c.negocio_cobrar.id_cliente,nombre:c.negocio_cobrar.nombre_negocio,tipo:c.negocio_cobrar.tipo,contratos:[]}),p()):n.setError("negocio_cobrar",{message:"El negocio ya existe en la planilla actual"})},handleSetHide:p}},un=()=>{const{modalAgregarNegocio:n}=i.exports.useContext(fe),{modalState:o,setHide:r}=n,t=re({resolver:se(dn)}),{handleAppendNegocio:a,handleSetHide:s}=mn(t,r);return e(le,D(C({},t),{children:e(W,{state:o,title:"Agregar Negocio",setHide:()=>s(),cancelBotton:{text:"Cerrar",actionFunction:()=>s()},actionButton:{text:"Agregar",actionFunction:t.handleSubmit(a)},children:e(Xo,{name:"negocio_cobrar",label:"Negocio"})})}))},ho=i.exports.createContext({}),pn=({children:n,clienteId:o,mainNegocioId:r})=>{const t=U();return e(ho.Provider,{value:{modalSaveData:t,clienteId:o,mainNegocioId:r},children:n})},hn="_divSaveData_28j6j_1";var gn={divSaveData:hn};const xn=()=>{const{id:n}=oe(),{fetcherSaveData:o}=i.exports.useContext(J),[,r]=o;return{handleSaveData:a=>{r(`/admin/planillas/${n}/edit`,{method:"POST",data:a})}}},Nn=()=>{const{fetcherSaveData:n}=i.exports.useContext(J),{modalSaveData:o}=i.exports.useContext(ho),{modalState:r,setHide:t,setOpen:a}=o,{handleSubmit:s,formState:p}=A(),{errors:u}=p,{handleSaveData:c}=xn(),[m,,x,b]=n,[,,,g]=i.exports.useContext(w),{setEditing:N}=i.exports.useContext(H),v=i.exports.useCallback(()=>{t(),x&&!b&&(N(!1),g())},[x,b]);return l(f,{children:[e(Z,{}),e("div",{className:gn.divSaveData,children:e(ce,{variant:"outlined",onClick:()=>a(),children:"Guardar"})}),e(W,{state:r,setHide:()=>v(),title:"\xA1Atenci\xF3n!",type:x?"SUCCESS":"ERROR",cancelBotton:{text:"Cerrar",actionFunction:()=>v()},actionButton:!u.negocios&&(!x||b)?{text:"Guardar",actionFunction:s(c),isLoading:m}:void 0,children:x?l(f,{children:[x.message,"."]}):u.negocios?e(f,{children:"Se encontraron errores en el formulario. Favor corregir antes de avanzar."}):!u.negocios&&!b?e(f,{children:"\xBFRealmente desea guardar los datos?"}):e(f,{children:b==null?void 0:b.message})})]})},bn=()=>{const n=i.exports.useContext(J),{fieldsNegocios:o,isDecimo:r}=n,{mainNegocioId:t,clienteId:a}=n,{fields:s}=o;return l(rn,{children:[e(ee,{variant:"outlined",className:h.paperTables,children:l(P,{direction:"column",spacing:1,marginTop:1,margin:1,children:[s.map((p,u)=>l(ee,{variant:"outlined",children:[l(S,{variant:"h5",textTransform:"uppercase",fontWeight:"bold",padding:1,color:u===0?"red":"darkorange",children:[p.tipo," ",p.nombre]}),e(Jt,{mainNegocioId:s[0].id_negocio,clienteId:s[0].id_cliente,negocioIndex:u,isDecimo:r,children:l(Kt,{children:[e(an,{negocioIndex:u}),e(ln,{})]})})]},`${u}`)),e(ee,{variant:"outlined",className:h.paperNotas,children:l(P,{direction:"column",spacing:1,children:[e(S,{variant:"h5",children:"Notas:"}),e(Z,{}),e(Zo,{name:"notas",height:300})]})}),e(pn,{mainNegocioId:t,clienteId:a,children:e(Nn,{})})]})}),e(un,{})]})},fn=()=>e($t,{children:e(bn,{})}),_n=I({edit_token:R().trim().required("Favor ingresar la contrase\xF1a")}),vn=()=>{var z;const{id:n}=oe(),{modalEditar:o,setEditing:r}=i.exports.useContext(H),{modalState:t,setHide:a}=o,{register:s,formState:p,handleSubmit:u,reset:c}=re({mode:"all",resolver:se(_n)}),{errors:m}=p,x=Y(),[b,g,N,v,,F]=x,T=i.exports.useCallback(()=>{a(),N&&r(!0),F(),c({edit_token:""})},[N,v]);return e(W,{state:t,setHide:T,type:N?"SUCCESS":"ERROR",title:N?"\xA1Atenci\xF3n!":"Favor ingresar la contrase\xF1a",cancelBotton:{text:N?"Cerrar":"Cancelar",actionFunction:T},actionButton:N?void 0:{text:"V\xE1lidar",actionFunction:u(async y=>{c(),await g(`/admin/planillas/${n}/check-token`,{method:"POST",data:y})}),isLoading:b},children:l("div",{style:{display:"flex",flexDirection:"column"},children:[(N||v)&&l(de,{variant:"outlined",severity:N?"success":"error",style:{marginBottom:10},children:[N&&!v&&e(f,{children:N.message}),v&&e(f,{children:v.message})]}),!N&&e(X,C({label:"Contrase\xF1a",fullWidth:!0,required:!0,helperText:(z=m==null?void 0:m.edit_token)==null?void 0:z.message,error:!!(m!=null&&m.edit_token),autoFocus:!0,focused:!0},s("edit_token")))]})})};var _e={},Cn=no.exports;Object.defineProperty(_e,"__esModule",{value:!0});var go=_e.default=void 0,Sn=Cn(to),Fn=ao,wn=(0,Sn.default)((0,Fn.jsx)("path",{d:"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"}),"ContentCopy");go=_e.default=wn;const yn=()=>{const{id:n}=oe(),{modalGenerarPassword:o}=i.exports.useContext(H),{modalState:r,setHide:t}=o,a=Y(),[s,p,u,c,,m]=a,x=i.exports.useCallback(()=>{t(),m()},[]);return i.exports.useEffect(()=>{(()=>{r?p(`/admin/planillas/${n}/generate-token`,{method:"POST"}):m()})()},[r]),l(W,{state:r,setHide:x,cancelBotton:{text:"Cerrar",actionFunction:x,isLoading:s},actionButton:!u&&c?{text:"Reintentar",actionFunction:()=>{m(),p(`/admin/planillas/${n}/generate-token`,{method:"POST"})}}:void 0,title:"\xA1Atenci\xF3n!",type:u?"SUCCESS":"ERROR",body:c==null?void 0:c.message,children:[s&&e(oo,{}),!s&&u&&e("div",{style:{display:"flex",flexDirection:"row",justifyContent:"center"},children:e(X,{InputProps:{readOnly:!0,endAdornment:e(et,{position:"end",children:e(io,{onClick:()=>navigator.clipboard.writeText(u.token),children:e(go,{})})})},value:u==null?void 0:u.token})})]})},$n=()=>{const{modalDownload:n,fetchDownload:o}=i.exports.useContext(H),{modalState:r,setHide:t}=n,[a,,s,p,,u]=o,c=i.exports.useCallback(()=>{t(),u()},[]);return l(f,{children:[e(ot,{open:a}),e(W,{state:r,title:"\xA1Atenci\xF3n!",type:s?"SUCCESS":"ERROR",setHide:()=>c(),cancelBotton:{text:"Cerrar",actionFunction:()=>c()},children:p?p.message:l(f,{children:["\xA1Archivo descargado correctamente!. ",e("br",{})," \xA1Si el archivo se envi\xF3 al ",e("strong",{children:"SIPE"}),", recuerde marcar la planilla como enviada!"]})})]})},En=()=>{const[,n,,,o]=i.exports.useContext(w),{modalSend:r}=i.exports.useContext(H),{modalState:t,setHide:a}=r,s=Y(),[p,u,c,m,,x]=s,{id:b}=oe(),g=i.exports.useCallback(()=>{a(),x(),c&&o(D(C({},n),{fecha_send_sipe:"2020-01-01"}))},[c,m]);return e(f,{children:e(W,{state:t,setHide:()=>g(),title:"\xA1Atenci\xF3n!",type:c?"SUCCESS":"ERROR",body:c?c.message:m?m.message:"\xBFRealmente desea marcar la planilla como formarto SIPE enviado?",actionButton:c?void 0:{text:"Ok",actionFunction:()=>{u(`/admin/planillas/${b}/send`,{method:"POST",data:{name:"sipe"}})},isLoading:p},cancelBotton:{text:c?"Cerrar":"Cancelar",actionFunction:()=>g()}})})},An=()=>{const{editing:n}=i.exports.useContext(H),[,o,r]=i.exports.useContext(w);return l(f,{children:[!o&&!r&&e(oo,{}),!o&&r&&e($o,{text:r.message}),o&&!r&&l(P,{direction:"column",spacing:1,children:[e(it,{}),n?e(fn,{}):l(f,{children:[e(ut,{}),e(Nt,{}),e(wt,{}),e(vn,{}),e($n,{}),e(yn,{}),e(En,{})]})]})]})},rr=()=>e(tt,{children:l(St,{children:[e(vo,{message:"Planilla"}),e(An,{})]})});export{rr as default};
