var I=Object.defineProperty,L=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var E=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable;var R=(a,t,r)=>t in a?I(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,C=(a,t)=>{for(var r in t||(t={}))A.call(t,r)&&R(a,r,t[r]);if(E)for(var r of E(t))T.call(t,r)&&R(a,r,t[r]);return a},v=(a,t)=>L(a,U(t));var O=(a,t)=>{var r={};for(var n in a)A.call(a,n)&&t.indexOf(n)<0&&(r[n]=a[n]);if(a!=null&&E)for(var n of E(a))t.indexOf(n)<0&&T.call(a,n)&&(r[n]=a[n]);return r};import{u as _,C as q,c as $,d as W,b as V,f as j,F as H,o as N}from"./array.js";import{r as h,a as l,U as G,j as S,F as k,a4 as J}from"./index.js";import{T as Q}from"./TextInput.js";import{V as X,S as K}from"./index.esm.js";import{d as Y,a as Z}from"./CheckBoxOutlineBlank.js";import{u as ee}from"./useMediaQuery.js";import{L as te,A as re,c as oe}from"./Autocomplete.js";import{C as ae}from"./Checkbox.js";import{T as ne}from"./Typography.js";import"./BootstrapTooltip.js";import{u as se}from"./useModal.js";import"./jwt-decode.esm.js";import{u as ie}from"./useFirstFetch.js";import"./ContentProvider.js";import{B as le}from"./BackgroundLoader.js";import{M as ue}from"./Modal2.js";import"./platform.js";import{M as me}from"./ModalMessage.js";import{u as ce}from"./useFetch.js";import{F as de}from"./FileSaver.min.js";import{E as pe}from"./exceljs.min.js";import{f as z}from"./date.helper.js";import"./upperFirst.js";import"./TextField.js";import"./useControlled.js";import"./react-is.production.min.js";import"./Menu.js";import"./Modal.js";import"./Backdrop.js";import"./isHostComponent.js";import"./Portal.js";import"./Paper.js";import"./Grow.js";import"./List.js";import"./createSvgIcon.js";import"./GlobalStyles.js";import"./Tooltip.js";import"./useIsFocusVisible.js";import"./ButtonBase.js";import"./jsx-runtime_commonjs-proxy.js";import"./Close.js";import"./IconButton.js";import"./Chip.js";import"./extendSxProp.js";import"./useAsyncRetry.js";import"./tslib.js";import"./useHttpService.js";import"./constants.js";import"./Close2.js";import"./Error.js";import"./Button.js";import"./index13.js";import"./index14.js";const B=8,he=a=>{const{data:t,index:r,style:n}=a,e=t[r],u=v(C({},n),{top:n.top+B});return e.hasOwnProperty("group")?l(te,{component:"div",style:u,children:e.group},e.key):S("li",v(C({},e[0]),{style:u,children:[l(ae,{icon:l(Y,{fontSize:"small"}),checkedIcon:l(Z,{fontSize:"small"}),style:{marginRight:8},checked:e[2]}),S(ne,{noWrap:!0,children:[e[1],e.length>3?S(k,{children:["- ",e[3]]}):null]})]}))},P=h.exports.createContext({}),fe=h.exports.forwardRef((a,t)=>{const r=h.exports.useContext(P);return l("div",C(C({ref:t},a),r))}),ge=a=>{const t=h.exports.useRef(null);return h.exports.useEffect(()=>{t.current!=null&&t.current.resetAfterIndex(0,!0)},[a]),t},Ce=h.exports.forwardRef(function(t,r){const p=t,{children:n}=p,e=O(p,["children"]),u=[];n.forEach(c=>{u.push(c),u.push(...c.children||[])});const f=G(),b=ee(f.breakpoints.up("sm"),{noSsr:!0}),d=u.length,x=b?36:48,s=c=>c.hasOwnProperty("group")?48:x,m=()=>d>8?8*x:u.map(s).reduce((c,y)=>c+y,0),g=ge(d);return l("div",{ref:r,children:l(P.Provider,{value:e,children:l(X,{itemData:u,height:m()+2*B,width:"100%",ref:g,outerElementType:fe,innerElementType:"ul",itemSize:c=>s(u[c]),overscanCount:5,itemCount:d,children:he})})})}),xe=u=>{var f=u,{options:a,loading:t,property:r,secondProperty:n}=f,e=O(f,["options","loading","property","secondProperty"]);const[b,d]=h.exports.useState(!1),x=()=>d(!1),s=()=>d(!0),{formState:m,setValue:g,watch:p,control:c}=_(),y=p(e.name);return l(q,{name:e.name,control:c,render:({field:w})=>l(re,v(C({},w),{fullWidth:!0,disablePortal:!0,multiple:!e.disableMultiple,disableCloseOnSelect:!e.disableMultiple,open:b,onOpen:()=>{s(),e.onOpen&&e.onOpen()},onClose:()=>{x(),e.onClose&&e.onClose()},options:a,getOptionDisabled:o=>!!(Array.isArray(y)&&e.limit&&y.length===e.limit&&!y.includes(o)),getOptionLabel:o=>r?o[`${r}`].toUpperCase():o.toUpperCase(),loading:t,disableClearable:!0,onChange:(o,i)=>g(e.name,i,{shouldValidate:!0}),blurOnSelect:!0,PopperComponent:K,ListboxComponent:Ce,renderOption:(o,i,{selected:F})=>[o,r?i[`${r}`].toUpperCase():i.toUpperCase(),F,...n?[i[`${n}`].toUpperCase()]:[]],filterOptions:oe({matchFrom:"any",ignoreAccents:!0,stringify:o=>{let i=r?o[`${r}`]:o;return n&&o[`${n}`]&&(i+=" "+o[`${n}`]),i}}),renderInput:o=>{var i,F,M,D;return l(Q,v(C({},o),{variant:"outlined",fullWidth:!0,label:e.label,error:!!((F=e.error)!=null?F:(i=m.errors[e.name])==null?void 0:i.message),helperText:(D=e.helperText)!=null?D:(M=m.errors[e.name])==null?void 0:M.message,required:e.required,InputProps:v(C({},o.InputProps),{endAdornment:S(k,{children:[t?l(J,{color:"inherit",size:20}):null,o.InputProps.endAdornment]})})}))}}))})},be=(a,t,r)=>{const{isLoading:n,send:e}=ce(),[u,f]=h.exports.useState(),b="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",d=".xlsx";return{isLoading:n,handleDownload:async s=>{var g;t();const m=await e({url:"/admin/negocios/archive/rutas",method:"POST",data:{rutas:s.rutas}});if(m.status===201&&m.data){const p=new pe.Workbook;for(const w of m.data){const o=p.addWorksheet(`Ruta ${w.ruta}`,{pageSetup:{paperSize:5,margins:{bottom:.1,left:.1,right:.1,top:.1,footer:.1,header:.1},printTitlesRow:"1:1"}});o.mergeCells("A1:D1"),o.mergeCells("A2:B2"),o.mergeCells("D2:E2"),o.getCell("B2").value="NOMBRE",o.getCell("C2").value="\u2714",o.getCell("E2").value="FICHA S.S",o.columns=[{header:"TIPO",key:"tipo",width:25},{header:"",key:"nombre",width:35},{header:"\u2714",key:"check",width:5},{header:`${z(`${new Date}`,"MMMM yyyy")}`.toUpperCase(),key:"check_ficha",width:5},{header:w.ruta,key:"ficha",width:35.7}],w.negocios.forEach(i=>o.addRow({tipo:i.tipo,nombre:i.nombre})),o.columns.forEach(i=>{i.border={top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}},i.alignment={wrapText:!0}}),o.getCell("D1").alignment={horizontal:"center"},o.getCell("D1").font={size:14},o.getCell("E1").alignment={horizontal:"right"},o.getCell("E1").font={size:14},o.getCell("B2").alignment={horizontal:"center"},o.getCell("B2").font={bold:!0},o.getCell("E2").font={bold:!0}}const c=await p.xlsx.writeBuffer(),y=new Blob([c],{type:b});de.exports.saveAs(y,`Rutas-${z(`${new Date}`,"MMMM-yyyy")}${d}`),f({status:m.status,data:m.status===201?{message:"Archivo descargado correctamente"}:void 0,error:void 0}),r()}else f({status:m.status,data:void 0,error:{message:((g=m.error)==null?void 0:g.message)||"Error al descargar las rutas"}}),r();a()},response:u}},ye=$().shape({rutas:W().of($().shape({id:V().typeError("Favor seleccionar la ruta").integer("Favor seleccionar la ruta").positive("Favor seleccionar la ruta").min(1,"Favor seleccionar la ruta").required("Favor seleccionar la ruta")})).typeError("Favor seleccionar al menos un ruta").min(1,"Favor seleccionar al menos un ruta").required("Favor seleccionar al menos una ruta")}),vt=({state:a,setHide:t,setRutas:r,rutas:n})=>{const e=j({mode:"all",resolver:N(ye)}),u=se(),{isLoading:f,handleDownload:b,response:d}=be(e.reset,t,u.setOpen),{loading:x,value:s}=ie({url:"/admin/negocios/rutas"}),[m,g]=h.exports.useState(!1);return h.exports.useEffect(()=>{(()=>{s&&s.status===201&&s.data&&r(s.data)})()},[s,r]),S(k,{children:[l(le,{open:f}),l(me,{state:u.modalState,setHide:u.setHide,response:d}),l(ue,{state:a,setHide:()=>{t&&t(),e.reset()},title:"Favor seleccionar una opci\xF3n de ruta",bodySx:{height:m?300:void 0},body:!x&&s&&s.status!==201?"Error al cargar las ruta":void 0,actionButton:{text:"descargar",actionFunction:e.handleSubmit(b)},children:l(H,v(C({},e),{children:l(xe,{label:"Rutas",name:"rutas",property:"ruta",options:s&&s.status===201&&s.data&&n?n==null?void 0:n.map(p=>p):[],loading:x,required:!0,onOpen:()=>g(!0),onClose:()=>g(!1)})}))})]})};export{vt as default};
