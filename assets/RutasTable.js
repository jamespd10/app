import{r as u,j as T,a as t,F as y,b as w,av as z}from"./index.js";import"./BootstrapTooltip.js";import{N as j}from"./NotFoundResults.js";import"./SpeedDial.module.js";import{C as k}from"./ChipState.js";import"./Modal.js";import"./SelectedCard.js";import{C as B}from"./CustomTable.js";import{z as H}from"./date.helper.js";import{f as O}from"./string.helper.js";import{R as P,a as E}from"./index45.js";import{I as M}from"./InputDecimal.js";import{u as A}from"./useFetch.js";import{u as V}from"./useComponentVisible.js";import{C as $}from"./CircularProgress.js";import{C as L}from"./Checkbox.js";import"./Tooltip.js";import"./Popper.js";import"./Portal.js";import"./useIsFocusVisible.js";import"./isHostComponent.js";import"./Grow.js";import"./useControlled.js";import"./useId.js";import"./Grid.js";import"./Typography.js";import"./CheckCircle.js";import"./jsx-runtime_commonjs-proxy.js";import"./createSvgIcon.js";import"./Error.js";import"./Chip.js";import"./ButtonBase.js";import"./emotion-react.browser.esm.js";import"./Close2.js";import"./DialogTitle.js";import"./dialogTitleClasses.js";import"./ModalTransition.js";import"./Backdrop.js";import"./Fade.js";import"./Modal2.js";import"./Paper.js";import"./IconButton.js";import"./Warning.js";import"./DialogContent.js";import"./DialogActions.js";import"./LoadingButton.js";import"./Button.js";import"./Search.js";import"./Clear.js";import"./TextField.js";import"./useFormControl.js";import"./formControlState.js";import"./react-is.production.min.js";import"./List.js";import"./outlinedInputClasses.js";import"./GlobalStyles.js";import"./Box.js";import"./InputAdornment.js";import"./RadioGroup.js";import"./SwitchBase.js";import"./FormGroup.js";import"./FormControlLabel.js";import"./SkipNextOutlined.js";import"./Pagination.js";import"./TableRow.js";import"./Loader.js";import"./Stack.js";import"./LinearProgress.js";import"./regex.js";import"./useFetchPagination.js";import"./useAsyncRetry.js";import"./useList.js";import"./usePrevious.js";import"./useHttpService.js";import"./object.helper.js";import"./HeaderTitle.js";import"./Divider.js";import"./TextInput.js";import"./CustomDecimal.js";import"./react-number-format.es.js";const v={label:"Rutas",name:"ruta",value:"%%",list:[{value:"%%",label:"Todas"},{value:"San Miguelito",label:"SM"},{value:"Panam\xE1",label:"PMA"},{value:"R\xEDo Abajo",label:"RA"},{value:"Juan D\xEDaz",label:"JD"},{value:"Chorrera",label:"CHO"},{value:"Chilibre",label:"CHI"},{value:"Pacora",label:"PAC"},{value:"Dari\xE9n",label:"DAR"},{value:"Oficina",label:"OF"},{value:"Interior",label:"INT"},{value:"Veracruz",label:"VER"}]},G={label:"Presentadas en DGI",name:"presentada",value:"%%",list:[{value:"%%",label:"Todas"},{value:"si",label:"Si presentadas"},{value:"no",label:"No presentadas"}]},W={label:"Regres\xF3 al local",name:"regreso",value:"%%",list:[{value:"%%",label:"Todas"},{value:"si",label:"Si se regres\xF3"},{value:"no",label:"No se regres\xF3"}]},U=[{name:"impresa",value:"no",label:"No impresas"}],J=({value:s,id:n})=>{const{ref:e,visible:p,setVisible:r}=V(!1),{rutaAlternaState:f,set:c}=u.exports.useContext(P),[l,a]=u.exports.useState(s||0),{send:i,isLoading:d}=A();return T("form",{ref:e,onSubmit:async m=>{m.preventDefault();const x=await i({url:`/admin/ruta-alterna/${n}/edit-total-cobrado`,method:"POST",data:{total:l}}),h=[...f],b=h.findIndex(g=>g.id===n);x.status===201?(h[b].total_cobrado=l,c([...h]),r(!1)):a(h[b].total_cobrado||0)},children:[!p&&t("span",{onClick:()=>r(!0),style:{cursor:"pointer"},children:d?t($,{}):O(s)}),p&&t(M,{label:"Total Cobrado",size:"small",value:l,onChange:m=>a(Number(m.target.value)),loading:d,style:{minWidth:150}})]})},Q=()=>{var p,r,f,c;const{selectedList:s,setSelectedList:n,value:e}=u.exports.useContext(E);return t(y,{children:t("div",{style:{display:"flex",justifyContent:"center"},children:t(L,{checked:s.filter(l=>{var a,i;return(i=(a=e==null?void 0:e.data)==null?void 0:a.resultados)==null?void 0:i.map(d=>d.id).includes(l.id)}).length===(((r=(p=e==null?void 0:e.data)==null?void 0:p.resultados)==null?void 0:r.length)||0),indeterminate:s.filter(l=>{var a,i;return(i=(a=e==null?void 0:e.data)==null?void 0:a.resultados)==null?void 0:i.map(d=>d.id).includes(l.id)}).length>0&&s.filter(l=>{var a,i;return(i=(a=e==null?void 0:e.data)==null?void 0:a.resultados)==null?void 0:i.map(d=>d.id).includes(l.id)}).length<(((c=(f=e==null?void 0:e.data)==null?void 0:f.resultados)==null?void 0:c.length)||0),onChange:({target:{checked:l}})=>{l?l&&e&&e.data&&n([...s,...e.data.resultados.filter(a=>{var i;return a.id!==((i=s.find(d=>a.id===d.id))==null?void 0:i.id)})]):n([])}})})})},q=()=>{const{rutaAlternaState:s,set:n}=u.exports.useContext(P),{send:e,isLoading:p}=A();return{handleCheck:async({id:f,name:c})=>{if((await e({url:`/admin/ruta-alterna/${f}/${c}`,method:"POST"})).status===201){const a=s.findIndex(d=>d.id===f),i=[...s];i[a][c]=!Boolean(Number(i[a][c])),n([...i])}},isLoading:p}},R=({id:s,name:n,value:e})=>{const{handleCheck:p,isLoading:r}=q();return t(y,{children:t(k,{label:Boolean(Number(e))?"SI":"NO",color:Boolean(Number(e))?"success":"error",onClick:()=>p({id:s,name:n}),loading:r})})},K=()=>{const{rutaAlternaState:s,set:n}=u.exports.useContext(P),{send:e,isLoading:p}=A(),[r,f]=u.exports.useState(),[c,l]=u.exports.useState(""),a=["ACH","CHEQUE","EFECTIVO","NO PAGADO"],i=()=>{const m=s.findIndex(h=>h.id===(r==null?void 0:r.id)),x=[...s];x[m].tipo_pago=c,n([...x])},d=async()=>{try{(r==null?void 0:r.tipo)!==c&&(await e({url:`/admin/ruta-alterna/${r==null?void 0:r.id}/edit-tipo-pago`,method:"POST",data:{tipo:r==null?void 0:r.tipo}})).status!==201&&i()}catch{i()}finally{l("")}};return u.exports.useEffect(()=>{const m=setTimeout(()=>{r&&d()},1e3);return()=>clearTimeout(m)},[r]),{handleChangeTipo:(m,x)=>{const h=a.findIndex(S=>S===x),b=s.findIndex(S=>S.id===m),g=[...s],C=a[h+1>a.length-1?0:h+1];g[b].tipo_pago=C,n([...g]),c===""&&l(x),f({id:m,tipo:C})},isLoading:p}},X=({id:s,name:n})=>{const{handleChangeTipo:e,isLoading:p}=K();return t(y,{children:t(k,{label:n,color:n==="NO PAGADO"?"error":"success",onClick:()=>e(s,n),loading:p})})},Y=u.exports.lazy(()=>w(()=>import("./Acciones7.js"),["assets/Acciones7.js","assets/index.js","assets/index17.css","assets/Print.js","assets/jsx-runtime_commonjs-proxy.js","assets/createSvgIcon.js","assets/useId.js","assets/useControlled.js","assets/useIsFocusVisible.js","assets/CustomDatePicker.js","assets/MobileDatePicker.js","assets/MonthPicker.js","assets/Typography.js","assets/PureDateInput.js","assets/CalendarPicker.js","assets/ButtonBase.js","assets/emotion-react.browser.esm.js","assets/Fade.js","assets/IconButton.js","assets/Grid.js","assets/InputAdornment.js","assets/useFormControl.js","assets/ModalTransition.js","assets/Backdrop.js","assets/Modal2.js","assets/isHostComponent.js","assets/Portal.js","assets/Paper.js","assets/DialogContent.js","assets/dialogTitleClasses.js","assets/DialogActions.js","assets/Button.js","assets/index13.js","assets/CustomSpeedDial.js","assets/Assignment.js","assets/FabButtonAction.js","assets/react-is.production.min.js","assets/AssignmentRounded.js","assets/Tooltip.js","assets/Popper.js","assets/Grow.js","assets/SpeedDial.module.js","assets/SpeedDial.module.css","assets/Stack.js","assets/BootstrapTooltip.js","assets/BackgroundLoader.js","assets/CircularProgress.js","assets/Modal.js","assets/Close2.js","assets/DialogTitle.js","assets/Warning.js","assets/Error.js","assets/CheckCircle.js","assets/LoadingButton.js","assets/SelectedCard.js","assets/useHandlePrint.js","assets/index25.js","assets/index45.js","assets/useFetchPagination.js","assets/useAsyncRetry.js","assets/useList.js","assets/usePrevious.js","assets/useHttpService.js","assets/object.helper.js","assets/useFetch.js","assets/Loader.js","assets/HeaderTitle.js","assets/Divider.js","assets/Box.js"])),Ft=()=>{var I,N;const{factura:s}=z(),{loading:n,value:e,page:p,handlePage:r,handleSkipNext:f,handleSkipPrev:c,filterList:l,setFilter:a,inputRef:i,sendSearch:d,filterRadioList:_,setFilterRadio:m,onClearSearch:x,reset:h,selectedList:b,setSelectedList:g}=u.exports.useContext(E),{rutaAlternaState:C,set:S}=u.exports.useContext(P);return u.exports.useEffect(()=>{(()=>{h(),S([])})()},[s]),u.exports.useEffect(()=>{(()=>{e&&e.status===201&&e.data&&S(e.data.resultados)})()},[e]),T(y,{children:[t(B,{title:"Lista de facturas alternas realizadas",size:"small",stickyHeader:!0,containerSx:{maxHeight:o=>`calc(100vh - ${o.spacing(15)})`},isSearch:{helperText:"por nombre del negocio, RUC o fecha. Ejm: 30-01-2020",focus:!0,input:{inputRef:i,onClick:d,onClear:x}},filter:{filterCheck:{setFilter:a,filterList:l,list:U},filterRadio:{setFilterRadio:m,filterRadioList:_,radios:[v,G,W]}},loading:n,notFound:(e==null?void 0:e.status)!==201&&t(j,{text:(I=e==null?void 0:e.error)==null?void 0:I.message}),tableHeader:[t(Q,{}),"Nombre del negocio","Cliente","RUC","Ruta","Fecha","Total","Total cobrado","Impresa","Tipo de pago","Pagada","\xBFSe regres\xF3?","P. DGI"],tableBody:C==null?void 0:C.map(o=>[t("div",{style:{display:"flex",justifyContent:"center"},children:t(L,{checked:b.map(F=>F.id).includes(o.id),onChange:({target:{checked:F}})=>{g(F?[...b,o]:[...b.filter(D=>D.id!==o.id)])}})}),t("div",{style:{overflow:"hidden",maxWidth:"350px",textOverflow:"ellipsis"},children:t("span",{style:{textTransform:"uppercase"},children:o.nombre_negocio})}),t("div",{style:{overflow:"hidden",maxWidth:"350px",textOverflow:"ellipsis"},children:T("span",{style:{textTransform:"uppercase"},children:[o.tipo_personal&&o.tipo_personal!==""?T("span",{style:{fontWeight:"bold"},children:[o.tipo_personal," -"," "]}):"",o.nom_cliente]})}),t("span",{style:{textTransform:"uppercase"},children:o.ruc}),t("span",{style:{textTransform:"uppercase"},children:o.ruta_iniciales}),t("span",{style:{textTransform:"uppercase"},children:o.fecha_ruta&&H(`${new Date(o.fecha_ruta)}`,"dd/MM/yy h:mm a")}),O(o.total),t(J,{id:o.id,value:o.total_cobrado}),t(k,{label:o.fecha_ruta?"SI":"NO",color:o.fecha_ruta?"success":"error"}),t(X,{id:o.id,name:o.tipo_pago}),t(R,{id:o.id,name:"cobro",value:o.cobro}),t(R,{id:o.id,name:"regreso",value:o.regreso}),t(R,{id:o.id,name:"presentada",value:o.presentada})]),pagination:{count:(N=e==null?void 0:e.data)==null?void 0:N.paginas,onChange:r,page:p},selectedCount:b.length,onSkipPrev:c,onSkipNext:f}),t(u.exports.Suspense,{fallback:t("div",{}),children:t(Y,{})})]})};export{Ft as default};
