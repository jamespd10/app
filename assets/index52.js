var w=Object.defineProperty,A=Object.defineProperties;var j=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var O=Object.prototype.hasOwnProperty,R=Object.prototype.propertyIsEnumerable;var z=(o,t,e)=>t in o?w(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,C=(o,t)=>{for(var e in t||(t={}))O.call(t,e)&&z(o,e,t[e]);if(B)for(var e of B(t))R.call(t,e)&&z(o,e,t[e]);return o},F=(o,t)=>A(o,j(t));import{T as v}from"./index18.js";import{r as s,t as T,as as $,a as r,aw as N,F as G,j as P,b as V}from"./index.js";import{B as H,a as U}from"./BootstrapModalTitle.js";import{d as q}from"./Paid.js";import{B as J}from"./BootstrapDivContent.js";import{a as y,i as K,I as Q}from"./itbmsSchema.js";import{d as W,o as X,F as Y,u as Z}from"./array.js";import{b as ee}from"./ModalTransition.js";import{B as te}from"./Button.js";import{L}from"./LoadingButton.js";import{L as S}from"./Loader.js";import{T as oe}from"./Typography.js";const E=s.exports.createContext({}),re=({children:o})=>{const{fetcher:t}=s.exports.useContext(y),[,,e]=t,a=W({mode:"all",resolver:X(K)}),{reset:d}=a,c=T(),i=T();return $(()=>{(()=>{e&&d(F(C({},e),{negocios:e.negocios.map(n=>F(C({},n),{acumulado:Number(n.total)<0?`${Math.abs(Number(n.total))}`:"0",gastos:n.gastos.length!==0?n.gastos:[{dv:"",nombre:"",ruc:"",texto:"",valor:""}],retenciones:n.retenciones.length!==0?n.retenciones:[{agente:"",dv:"",id_agente_retenedor:null,ruc:"",valor:""}]}))}))})()},[e]),r(Y,F(C({},a),{children:r(E.Provider,{value:{fetcher:c,fetcherProcesar:i},children:o})}))},se=()=>{const{fetcher:o}=s.exports.useContext(y),[,,t,,e]=o,a=s.exports.useContext(E),{fetcherProcesar:d,fetcher:c}=a,{pagination:i}=s.exports.useContext(v),{fetcher:m,currentValue:n}=i,[,h]=n,[,,f,,x]=m,[b,g,,,,l]=d,[,,,,,_]=c;return{loading:b,handleProcesar:async()=>{if(t){l(),_();const{data:u,error:k}=await g(`/admin/f430/${t.id}`,{method:"PATCH",data:{field:"formulario430.fecha_enviado",value:new Date}});if(u&&!k){const D=f.resultados.findIndex(I=>I.id===t.id);if(D!==-1){const I=N(new Date,"yyyy-MM-dd hh:mm:ss"),M=f.resultados;M[D].fecha_enviado=I,x({paginas:f.paginas,resultados:M}),h(null),e(null),l(),_()}}}}}},ae=()=>{const{pagination:o}=s.exports.useContext(v),{fetcher:t,currentValue:e}=o,[,,a,,d]=t,[c]=e,{fetcher:i}=s.exports.useContext(y),[,,m]=i,{fetcher:n}=s.exports.useContext(E),[h,f,,,,x]=n;return{loading:h,handleSave:async g=>{if(m){x();const{data:l,error:_}=await f(`/admin/f430/${m.id}`,{method:"PUT",data:g});if(l&&!_){const p=a.resultados.findIndex(u=>u.id===(c==null?void 0:c.id));if(p!==-1){const u=a.resultados;u[p].ventas=l.ventas,u[p].compras=l.compras,u[p].retenciones=l.retenciones,u[p].total=l.total,d({paginas:a.paginas,resultados:u})}}}}}},ne=()=>{const{editable:o,fetcher:t}=s.exports.useContext(y),[,,,,e]=t,{pagination:a}=s.exports.useContext(v),{currentValue:d}=a,[,c]=d,{loading:i,handleProcesar:m}=se(),{handleSubmit:n}=Z(),{loading:h,handleSave:f}=ae(),{fetcher:x,fetcherProcesar:b}=s.exports.useContext(E),[,,,,,g]=x,[,,,,,l]=b;return o?r(G,{}):P(ee,{children:[r(te,{variant:"outlined",color:"inherit",size:"small",onClick:()=>{c(null),g(),l(),e(null)},children:"Cerrar"}),o&&r(L,{variant:"outlined",color:"primary",size:"small",onClick:n(f),loading:h,children:"Guardar"}),o&&r(L,{variant:"contained",color:"error",size:"small",onClick:()=>m(),loading:i,children:"Enviar a factura"})]})},ce=s.exports.lazy(()=>V(()=>import("./FormularioRealizar2.js"),["assets/FormularioRealizar2.js","assets/index.js","assets/index6.css","assets/formulario.module.js","assets/formulario.module.css","assets/itbmsSchema.js","assets/array.js","assets/upperFirst.js","assets/regex.js","assets/Lazy.js","assets/ErrorIcon.js","assets/StyledGridOverlay.js","assets/Box.js","assets/Typography.js","assets/Loader.js","assets/Grid.js","assets/CircularProgress.js","assets/emotion-react.browser.esm.js"])),ie=s.exports.lazy(()=>V(()=>import("./MessageEditar.js"),["assets/MessageEditar.js","assets/index.js","assets/index6.css","assets/BootstrapModalAlert.js","assets/BootstrapModalAlert.css","assets/Alert.js","assets/createSvgIcon.js","assets/Close.js","assets/Paper.js","assets/IconButton.js","assets/ButtonBase.js","assets/emotion-react.browser.esm.js","assets/useIsFocusVisible.js","assets/index18.js","assets/index3.css","assets/HeaderTitle.js","assets/Typography.js","assets/Divider.js","assets/StyledSpeedDial.js","assets/Assignment.js","assets/jsx-runtime_commonjs-proxy.js","assets/useControlled.js","assets/FabButtonAction.js","assets/react-is.production.min.js","assets/AssignmentRounded.js","assets/Tooltip.js","assets/Popper.js","assets/Portal.js","assets/appendOwnerState.js","assets/isHostComponent.js","assets/Grow.js","assets/ContentProvider.js","assets/useModal.js","assets/SpeedDial.module.js","assets/SpeedDial.module.css","assets/Backdrop.js","assets/Stack.js","assets/Paid.js","assets/Loader.js","assets/Grid.js","assets/CircularProgress.js","assets/BootstrapModalTitle.js","assets/ModalTransition.js","assets/Modal2.js","assets/Close2.js","assets/BootstrapDivContent.js","assets/BootstrapDivContent.css","assets/itbmsSchema.js","assets/array.js","assets/upperFirst.js","assets/regex.js","assets/Lazy.js","assets/Button.js","assets/LoadingButton.js"])),le=s.exports.lazy(()=>V(()=>import("./MessageProcesar.js"),["assets/MessageProcesar.js","assets/index.js","assets/index6.css","assets/BootstrapModalAlert.js","assets/BootstrapModalAlert.css","assets/Alert.js","assets/createSvgIcon.js","assets/Close.js","assets/Paper.js","assets/IconButton.js","assets/ButtonBase.js","assets/emotion-react.browser.esm.js","assets/useIsFocusVisible.js","assets/index18.js","assets/index3.css","assets/HeaderTitle.js","assets/Typography.js","assets/Divider.js","assets/StyledSpeedDial.js","assets/Assignment.js","assets/jsx-runtime_commonjs-proxy.js","assets/useControlled.js","assets/FabButtonAction.js","assets/react-is.production.min.js","assets/AssignmentRounded.js","assets/Tooltip.js","assets/Popper.js","assets/Portal.js","assets/appendOwnerState.js","assets/isHostComponent.js","assets/Grow.js","assets/ContentProvider.js","assets/useModal.js","assets/SpeedDial.module.js","assets/SpeedDial.module.css","assets/Backdrop.js","assets/Stack.js","assets/Paid.js","assets/Loader.js","assets/Grid.js","assets/CircularProgress.js","assets/BootstrapModalTitle.js","assets/ModalTransition.js","assets/Modal2.js","assets/Close2.js","assets/BootstrapDivContent.js","assets/BootstrapDivContent.css","assets/itbmsSchema.js","assets/array.js","assets/upperFirst.js","assets/regex.js","assets/Lazy.js","assets/Button.js","assets/LoadingButton.js"])),de=()=>{const{pagination:o}=s.exports.useContext(v),{currentValue:t}=o,[e]=t;return P(H,{open:!!e,fullScreen:!0,children:[r(U,{children:P(oe,{component:"div",textTransform:"uppercase",display:"flex",flexDirection:"row",gap:1,alignItems:"center",padding:0,margin:0,children:[r(q,{}),"Formulario 430 - ITBMS"]})}),P(J,{children:[r(s.exports.Suspense,{fallback:r(S,{}),children:r(ie,{})}),r(s.exports.Suspense,{fallback:r(S,{}),children:r(le,{})}),r(s.exports.Suspense,{fallback:r(S,{}),children:r(ce,{})})]}),r(ne,{})]})},ue=()=>{const{pagination:o}=s.exports.useContext(v),{currentValue:t}=o,[e]=t,a=T(),[,d,c]=a;return s.exports.useEffect(()=>{(()=>{e&&d(`/admin/f430/${e.id}`)})()},[e]),r(Q,{fetcher:a,editable:!!(c&&c.negocios.every(i=>!i.fecha_enviado)),children:r(re,{children:r(de,{})})})};var Ee=Object.freeze(Object.defineProperty({__proto__:null,default:ue},Symbol.toStringTag,{value:"Module"}));export{E,Ee as i};
