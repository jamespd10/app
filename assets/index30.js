var B=Object.defineProperty,D=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable;var $=(o,r,t)=>r in o?B(o,r,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[r]=t,C=(o,r)=>{for(var t in r||(r={}))E.call(r,t)&&$(o,t,r[t]);if(A)for(var t of A(r))O.call(r,t)&&$(o,t,r[t]);return o},w=(o,r)=>D(o,I(r));import{a as e,r as l,aD as H,F,j as f,ax as M,b as R,ak as V,x as G}from"./index.js";import{L as j}from"./Loader.js";import{C as W}from"./ErrorIcon.js";import{S as q,a as J}from"./StyledCheckboxInherit.js";import{d as K}from"./Edit.js";import{I as P}from"./IconButton.js";import{C as z}from"./ChipState.js";import{f as Q}from"./string.helper.js";import{u as k}from"./useFetch.js";import{d as U,a as X}from"./SkipNextOutlined.js";import{P as Y}from"./Pagination.js";import{T as Z}from"./TextInput.js";import{d as ee}from"./Search.js";import{d as te}from"./Close2.js";import{F as oe}from"./Backdrop.js";import{_ as re,a as se}from"./useAsyncRetry.js";import{H as ae}from"./HeaderTitle.js";import{g as ne,o as ie}from"./array.js";import ce from"./Modal.js";import{u as le}from"./useHttpService.js";import{s as de}from"./facturacionSchema.js";import{T as L}from"./Typography.js";import{A as me}from"./Alert.js";import{d as ue}from"./PointOfSale.js";import{d as pe}from"./Print.js";import he from"./CustomSpeedDial.js";import"./BootstrapTooltip.js";import"./ContentProvider.js";import"./SpeedDial.module.js";import{B as fe}from"./BackgroundLoader.js";import"./SelectedCard.js";import{u as _e}from"./useHandlePrint.js";import{B as ge}from"./Box.js";import"./Grid.js";import"./StyledGridOverlay.js";import"./Checkbox.js";import"./FormHelperText.js";import"./ButtonBase.js";import"./useIsFocusVisible.js";import"./useControlled.js";import"./createSvgIcon.js";import"./TextField.js";import"./react-is.production.min.js";import"./Modal2.js";import"./isHostComponent.js";import"./Portal.js";import"./Paper.js";import"./Grow.js";import"./List.js";import"./GlobalStyles.js";import"./jsx-runtime_commonjs-proxy.js";import"./Error.js";import"./Chip.js";import"./regex.js";import"./Divider.js";import"./upperFirst.js";import"./LoadingButton.js";import"./Button.js";import"./Close.js";import"./Assignment.js";import"./FabButtonAction.js";import"./AssignmentRounded.js";import"./Tooltip.js";import"./Popper.js";import"./Stack.js";import"./useModal.js";import"./index15.js";const xe="_container_1ejrf_1",be="_pagination_1ejrf_7",Ce="_response_1ejrf_14",Se="_table_1ejrf_19",ve="_header_1ejrf_24",ye="_row_1ejrf_39",Pe="_column_1ejrf_39",Ne="_selected_1ejrf_51",Fe="_checkboxColumn_1ejrf_55",ke="_columnCenter_1ejrf_60",Te="_removeSpacing_1ejrf_64",we="_message_1ejrf_69";var p={container:xe,pagination:be,response:Ce,table:Se,header:ve,row:ye,column:Pe,selected:Ne,checkboxColumn:Fe,columnCenter:ke,removeSpacing:Te,message:we};const je=()=>e("tbody",{children:e("tr",{children:e("td",{className:p.loader,colSpan:8,children:e(j,{margin:20})})})}),_=l.exports.createContext({}),Ae=({children:o})=>{const r=H("/admin/proformas");return e(_.Provider,{value:{pagination:r},children:o})},$e=()=>{const{pagination:o}=l.exports.useContext(_),{fetcher:r}=o,[,,,t]=r;return e("tbody",{children:e("tr",{children:e("td",{className:p.message,colSpan:8,children:e(W,{label:t==null?void 0:t.message})})})})},T=l.exports.createContext({}),Le=({children:o})=>{const[r,t]=l.exports.useState(null);return e(T.Provider,{value:{proforma:r,setProforma:t},children:o})},Re=o=>{const{setProforma:r}=l.exports.useContext(T);return e(F,{children:e(P,{className:p.removeSpacing,color:"primary",size:"small",disableRipple:!0,onClick:()=>r(o),children:e(K,{})})})},ze=()=>{const{pagination:o}=l.exports.useContext(_),{fetcher:r}=o,[,,t,,n]=r,{send:s,isLoading:i}=k();return{handleCheck:async({id:a,name:d})=>{if((await s({url:`/admin/ruta-proformas/${a}/${d}`,method:"POST"})).status===201){const S=t.resultados.findIndex(g=>g.id===a),h=[...t.resultados];h[S][d]=!Boolean(Number(h[S][d])),n({paginas:t.paginas,resultados:[...h]})}},isLoading:i}},Be=({id:o,anulada:r})=>{const{handleCheck:t,isLoading:n}=ze();return e("td",{className:p.column,children:e(z,{label:Boolean(Number(r))?"NO":"SI",color:Boolean(Number(r))?"error":"success",loading:n,onClick:()=>t({id:o,name:"anulada"})})})},De=()=>{const{pagination:o}=l.exports.useContext(_),{fetcher:r,selected:t,setSelected:n}=o,[s,,i,c]=r;return!s&&!i&&c?e($e,{}):e("tbody",{children:i==null?void 0:i.resultados.map(a=>f("tr",{className:`${p.row} ${t.find(d=>d.id===a.id)?p.selected:""}`,children:[e("td",{className:p.column,children:e(q,{size:"small",disableRipple:!0,checked:!!t.find(d=>d.id===a.id),onChange:d=>{d.target.checked?n([...t,a]):n(t.filter(m=>m.id!==a.id))}})}),e("td",{className:`${p.column} ${p.columnCenter}`,children:e(Re,C({},a))}),f("td",{className:p.column,children:[a.tipo_only," ",a.nombre_only]}),e("td",{className:p.column,children:a.ruc}),e("td",{className:p.column,children:a.ruta_iniciales}),e("td",{className:p.column,children:M(a.mes_correspondiente,"dd/MM/yyyy hh:mm aaaa")}),e("td",{className:p.column,children:Q(a.total)}),e("td",{className:p.column,children:e(z,{label:a.fecha_impresion?"SI":"NO",color:a.fecha_impresion?"success":"error"})}),e(Be,C({},a))]},a.id))})},Ie=()=>{const{pagination:o}=l.exports.useContext(_),{fetcher:r,selected:t,setSelected:n}=o,[,,s]=r;return e("th",{className:p.checkboxColumn,children:e(J,{size:"small",disableRipple:!0,color:"secondary",checked:!!(s!=null&&s.resultados.every(i=>!!t.find(c=>c.id===i.id))),indeterminate:!!(s!=null&&s.resultados.some(i=>!!t.find(c=>c.id===i.id)))&&!(s!=null&&s.resultados.every(i=>!!t.find(c=>c.id===i.id))),onChange:i=>{if(i.target.checked&&s){const c=s.resultados.filter(a=>!t.find(d=>a.id===d.id));n([...t,...c])}else n([])}})})},Ee=()=>e("thead",{className:p.header,children:f("tr",{children:[e(Ie,{}),e("th",{}),e("th",{children:"Negocio"}),e("th",{children:"Ruc"}),e("th",{children:"Ruta"}),e("th",{children:"Fecha"}),e("th",{children:"Total"}),e("th",{children:"Impresa"}),e("th",{children:"Vigente"})]})}),Oe=()=>{const{pagination:o}=l.exports.useContext(_),{fetcher:r,page:t,setPage:n}=o,[,,s]=r;return f("div",{className:p.pagination,children:[e(P,{size:"small",onClick:()=>n(t-10),disabled:t<=10,children:e(U,{})}),e(Y,{color:"primary",count:s==null?void 0:s.paginas,page:t,onChange:(i,c)=>n(c)}),e(P,{size:"small",onClick:()=>n(t+10),disabled:!!(s&&s.paginas-o.page<10),children:e(X,{})})]})},He="_toolbar_1pm2e_1",Me="_title_1pm2e_7",Ve="_divToolbar_1pm2e_13",Ge="_child_1pm2e_20",We="_formSearch_1pm2e_24",qe="_searchAdorment_1pm2e_28",Je="_banner_1pm2e_34";var y={toolbar:He,title:Me,divToolbar:Ve,child:Ge,formSearch:We,searchAdorment:qe,banner:Je};const Ke=()=>{const o=l.exports.useRef(null),{pagination:r}=l.exports.useContext(_),{search:t,sendSearch:n}=r,[s,i]=l.exports.useState(t);return e("form",{onSubmit:a=>{a.preventDefault(),n(s)},className:y.formSearch,children:e(Z,{label:"Buscar...",size:"small",fullWidth:!0,autoFocus:!0,value:s,onChange:a=>i(a.target.value),inputRef:o,helperText:"Por raz\xF3n social, ruc, nombre del representante, c\xE9dula o pasaporte",InputProps:{endAdornment:f("div",{className:y.searchAdorment,children:[e(P,{size:"small",children:e(ee,{})}),s!==""&&e(P,{size:"small",onClick:()=>{var a;i(""),n(""),(a=o==null?void 0:o.current)==null||a.focus()},children:e(te,{})})]})}})})},Qe=()=>{const{pagination:o}=l.exports.useContext(_),{selected:r}=o,t=l.exports.useMemo(()=>r.length,[r]);return f(F,{children:[f("div",{className:y.toolbar,children:[e("span",{className:y.title,children:"Proformas realizadas"}),e("div",{className:y.divToolbar,children:e(Ke,{})})]}),e(oe,{in:t!==0,unmountOnExit:!0,children:f("div",{className:y.banner,children:[t," fila",t>1?"s":""," seleccionada",t>1?"s":""]})})]})},Ue=()=>{const{pagination:o}=l.exports.useContext(_),{fetcher:r}=o,[t,,n,s]=r;return f("div",{className:p.container,children:[f("div",{className:p.response,children:[e(Qe,{}),f("table",{className:p.table,children:[e(Ee,{}),t?e(je,{}):e(De,{})]})]}),!t&&n&&!s&&e(Oe,{})]})},Xe=()=>{const{send:o}=k(),[r,t]=l.exports.useState(null),[n,s]=l.exports.useState(null),i=Object.assign({}),{ruta:c}=i,{retry:a}=re(async()=>{(async()=>{if(c&&c!=="%%"){const m=await o({url:`/admin/proformas/fechas-rutas?ruta=${c}`});if(m&&m.status===201&&m.data&&m.data.length>0){const S={label:"Fecha de rutas",name:"fecha_ruta",value:"",list:[{value:"",label:"Todas"},{value:"%%",label:"No impresas"},...m.data]};t(m.data),s(S)}else t(null),s(null)}})()},[c]);return{fechaList:n,setFechaList:s,fechas:r,setFechas:t,retry:a}},Ye=l.exports.createContext({}),Ze=({children:o})=>{const{fechas:r,fechaList:t,setFechaList:n,setFechas:s,retry:i}=Xe();return e(Ye.Provider,{value:{fechas:r,setFechas:s,fechaList:t,setFechaList:n,retry:i},children:o})},et=()=>{const{proforma:o}=l.exports.useContext(T),{isLoading:r,send:t,response:n,reset:s}=k(),{pagination:i}=l.exports.useContext(_),{setSelected:c,fetcher:a}=i,[,,d,,m]=a;return{isLoading:r,response:n,onSubmit:async h=>{s();const g=await t({url:`/admin/proformas/${o==null?void 0:o.id}/edit`,method:"POST",data:h});if(g.status===201&&g.data){const x=d.resultados,b=x.findIndex(v=>v.id===(o==null?void 0:o.id));x[b]=w(C(C({},x[b]),h),{otros:h.otros[0].texto?h.otros:[],total:g.data.total}),m({paginas:d.paginas,resultados:[...x]}),c([])}},reset:s}},tt=l.exports.lazy(()=>R(()=>import("./FormModalEdit.js"),["assets/FormModalEdit.js","assets/index.js","assets/index7.css","assets/Loader.js","assets/Grid.js","assets/Typography.js","assets/BootstrapTooltip.js","assets/Tooltip.js","assets/Popper.js","assets/Portal.js","assets/useControlled.js","assets/useIsFocusVisible.js","assets/isHostComponent.js","assets/Grow.js","assets/ContentProvider.js","assets/useModal.js","assets/SpeedDial.module.js","assets/SpeedDial.module.css","assets/Modal.js","assets/Close2.js","assets/jsx-runtime_commonjs-proxy.js","assets/createSvgIcon.js","assets/LoadingButton.js","assets/Backdrop.js","assets/Modal2.js","assets/Paper.js","assets/Button.js","assets/ButtonBase.js","assets/IconButton.js","assets/Error.js","assets/SelectedCard.js","assets/array.js","assets/upperFirst.js"])),ot=()=>{var h,g,x;const{proforma:o,setProforma:r}=l.exports.useContext(T),t=le(),n=ne({resolver:ie(de),mode:"all"}),{isLoading:s,onSubmit:i,response:c,reset:a}=et(),{loading:d,value:m,error:S}=se(async()=>{if(o){const{id:b}=o,v=await t({url:`/admin/proformas/${b}`});if(v.status===201&&v.data){const u=v.data;n.reset({decimo:u.decimo,vacaciones:u.vacaciones,itbms:u.itbms,formulario_retencion_itbms:u.formulario_retencion_itbms,formulario_03:u.formulario_03,sipe:u.sipe,seguro_social:u.seguro_social,seguro_social2:u.seguro_social2,servicio_contabilidad:u.servicio_contabilidad,otro_costo:u.otro_costo,itbms_contabilidad:u.itbms_contabilidad,otros_text:u.otros_text,notas:u.notas,otros:u.otros&&u.otros.length>0?u.otros.map(N=>({texto:N.texto,valor:N.valor})):[{texto:void 0,valor:void 0}]})}return v}else return},[o]);return e(F,{children:f(ce,{fullScreen:!0,state:!!o,setHide:()=>{a(),r(null)},title:"Formulario de edici\xF3n de Proforma",cancelBotton:{text:"Cerrar",actionFunction:()=>{a(),r(null)}},actionButton:{text:"Guardar",actionFunction:n.handleSubmit(i),isLoading:s},children:[d&&e(j,{}),!d&&m&&m.status!==201&&m.error&&e(L,{children:m.error.message}),S&&e(L,{children:"Error al consultar los datos a modificar"}),c&&e(me,{severity:c.status===201?"success":"error",variant:"outlined",style:{marginBottom:10},children:(x=(h=c.data)==null?void 0:h.message)!=null?x:(g=c.error)==null?void 0:g.message}),!d&&m&&m.status===201&&m.data&&e(l.exports.Suspense,{fallback:e(j,{}),children:e(tt,{form:n,data:m.data})})]})})},rt=()=>{const{pagination:o}=l.exports.useContext(_),{selected:r,setSelected:t,fetcher:n}=o,[,,s,,i]=n,{isLoading:c,send:a,reset:d,response:m}=k();return{handleChecker:async(h,g)=>{d();const x=await a({url:"/admin/proformas/check",method:"POST",data:C({proformas:r==null?void 0:r.map(b=>({id:b.id})),type:h},g)});if(x.status===201&&x.data){const b=s.resultados;for(const[v,[,u]]of Object.entries(Object.entries(s.resultados)))r.map(N=>N.id).includes(u.id)&&(b[Number(v)]=w(C(C({},u),g),{fecha_impresion:h==="print"?new Date(Date.now()):u.fecha_impresion,fecha_anulacion:h==="anular"?new Date(Date.now()):u.fecha_anulacion,cancelado:h==="pagar"?new Date(Date.now()):u.cancelado}));i({paginas:s.paginas,resultados:[...b]}),t([])}},isLoading:c,response:m,reset:d}},st=l.exports.lazy(()=>R(()=>import("./ProformaPrintView.js"),["assets/ProformaPrintView.js","assets/date.helper.js","assets/index.js","assets/index7.css","assets/index13.js","assets/string.helper.js","assets/regex.js"])),at=()=>{const o=V(),{pagination:r}=l.exports.useContext(_),{selected:t}=r,{handleChecker:n,isLoading:s}=rt(),i=_e({pageStyle:"@page { margin: 0 !important; size: letter; }",onAfterPrint:async()=>await n("print"),title:"Proformas"});return f(F,{children:[e(fe,{open:s||i.printing}),e(he,{titles:["Realizar proforma",...t.length>0?["Imprimir proformas"]:[]],icons:[ue,...t.length>0?[pe]:[]],onPresses:[()=>o("/negocios?f=1"),...t.length>0?[()=>i.handlePrint()]:[]]}),e("div",{style:{display:"none"},children:e("div",{ref:i.elementRef,children:t.length>0&&t.sort((c,a)=>(c.recorrido||0)-(a.recorrido||0)).map(c=>e(l.exports.Suspense,{fallback:e("div",{}),children:e(st,C({},c))},c.id))})})]})},So=()=>e(Ae,{children:f(Le,{children:[e(ae,{message:"Facturaci\xF3n - proformas"}),e(ge,{style:{marginTop:10},children:e(l.exports.Suspense,{fallback:e(G,{}),children:f(Ze,{children:[e(Ue,{}),e(ot,{}),e(at,{})]})})})]})});export{So as default};
